<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Hebrew with MotiVation</title>
 <style>
      .hidden {
        display: none;
      }

      body {
        margin: 0;
        font-family: system-ui, sans-serif;
        background: #111;
        color: #fff;
        font-size: 17px;
        line-height: 1.55;
        letter-spacing: 0.3px;
        overflow-y: auto;
        overscroll-behavior: none;
      }

      /* ---------- SCREENS ---------- */

      .screen {
        display: none;
        padding: 18px;
        max-width: 420px;
        margin: auto;
        min-height: 100vh;
        box-sizing: border-box;
        overflow-y: auto;
      }

      .screen.active {
        display: block;
      }

      /* ---------- HOME ---------- */
      .welcome {
        font-size: 40px;
        font-weight: 800;
        text-align: center;
        margin-top: 35px;
      }
      .instructions {
        text-align: center;
        font-size: 25px;
        margin: 20px 0 30px;
        color: #bbb;
      }
      .title-bottom {
        text-align: center;
        font-size: 30px;
        margin-top: 28px;
        opacity: 0.85;
      }

      /* ---------- BUTTONS ---------- */
      button {
        width: 100%;
        padding: 14px;
        margin: 8px 0;
        font-size: 17px;
        font-weight: 600;
        letter-spacing: 0.3px;
        border: none;
        border-radius: 14px;
        cursor: pointer;
        background: linear-gradient(180deg, #f1f4f8, #dfe7f1);
        color: #222;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.25);
        transition:
          transform 0.1s,
          box-shadow 0.1s,
          background 0.2s;
      }
      button:hover {
        background: linear-gradient(180deg, #ffffff, #e6eef8);
      }
      button:active {
        transform: translateY(2px);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.35);
      }

      .forest {
        background: linear-gradient(180deg, #bbf7d0, #22c55e);
        color: #052e16;
      }

      .back {
        background: linear-gradient(180deg, #e0e0e0, #cfcfcf);
      }
      .button-danger {
        background: linear-gradient(180deg, #ff9aa2, #ff6f6f);
        color: #300;
      }

      .button-primary {
        background: linear-gradient(180deg, #9fc5ff, #6fa8ff);
        color: #002b5c;
      }

      .button-success {
        background: linear-gradient(180deg, #b7e4c7, #95d5b2);
        color: #103b24;
      }

      .button-bank {
        background: linear-gradient(180deg, #b7e4c7, #95d5b2);
        color: #103b24;
      }

      .peach {
        background: linear-gradient(180deg, #ffe5d9, #ffb4a2);
        color: #5a1f14;
      }
      .sunset {
        background: linear-gradient(180deg, #ffedd5, #fb923c);
        color: #4a1d00;
      }

      .lavender {
        background: linear-gradient(180deg, #ede9fe, #c4b5fd);
        color: #2e1065;
      }

      /* ---------- FORM ---------- */
      select,
      input,
      textarea {
        width: 100%;
        padding: 13px;
        margin: 8px 0;
        font-size: 17px;
        border-radius: 10px;
        border: none;
        box-sizing: border-box;
      }

      /* ---------- SESSION ---------- */

      .flip-hint {
        text-align: center;
        font-family: "Comic Sans MS", "Trebuchet MS", cursive;
        font-size: 30px;
        margin-bottom: 10px;
        color: #ffd966;
      }

      .card-frame {
        border: 5px solid #6fa8dc;
        border-radius: 18px;
        padding: 14px;
        background: #2a2a2a;
        box-shadow:
          0 10px 18px rgba(0, 0, 0, 0.6),
          inset 0 0 0 2px rgba(255, 255, 255, 0.08);
      }

      .card {
        background: #111;
        height: 220px; /* ×›×¨×˜×™×¡ ×§×‘×•×¢ */
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 102px; /* ×¤×™ 3 */
        line-height: 1.15;
        text-align: center;
        border-radius: 12px;
        padding: 20px;
        user-select: none;

        overflow: hidden; /* ×”×›×¨×˜×™×¡ ×œ× ×’×“×œ */
        white-space: normal; /* ××•×ª×¨ ×œ×©×‘×•×¨ ×©×•×¨×” */
        word-break: normal; /* âŒ ×œ× ×©×•×‘×¨×™× ××™×œ×” */
        overflow-wrap: normal; /* âŒ ×œ× ×©×•×‘×¨×™× ××™×œ×” */
      }

      .remaining {
        text-align: center;
        font-size: 20px;
        margin-top: 10px;
        color: #cfe2f3;
      }

      .row {
        display: flex;
        gap: 10px;
        margin-top: 14px;
      }
      .row button {
        width: 50%;
      }


      /* ---------- BANK ---------- */

      .word-files-invite {
        border: 2px solid #ffd966;
        border-radius: 18px;
        padding: 16px;
        margin: 16px 0;
        background: linear-gradient(180deg, #1f1f1f, #151515);
        box-shadow: 0 0 18px rgba(255, 217, 102, 0.25);
      }
      .word-files-invite h3 {
        text-align: center;
        font-size: 22px;
        color: #ffe599;
        margin-bottom: 6px;
      }
      .invite-main {
        text-align: center;
        font-size: 15px;
        margin-bottom: 10px;
      }
      .invite-cta {
        text-align: center;
        font-size: 17px;
        font-weight: 700;
        letter-spacing: 0.3px;
        padding: 12px;
        border-radius: 14px;
        background: linear-gradient(180deg, #9fc5ff, #6fa8ff);
        color: #002b5c;
        cursor: pointer;

        transition:
          transform 0.15s ease,
          box-shadow 0.15s ease,
          opacity 0.15s ease;
      }

      .invite-cta:hover {
        transform: translateY(-1px);
        box-shadow: 0 6px 14px rgba(0, 0, 0, 0.25);
        opacity: 0.95;
      }

      .invite-cta:active {
        transform: translateY(1px);
        box-shadow: 0 3px 6px rgba(0, 0, 0, 0.35);
      }

      /* ---------- DOWNLOAD ---------- */

      #download select {
        margin-bottom: 14px;
        background: #1c1c1c;
        color: #fff;
      }

      #download h2 {
        text-align: center;
        margin-bottom: 14px;
      }

      #downloadAccordions li {
        cursor: pointer;
        padding: 8px 6px;
        border-radius: 8px;
        transition:
          background 0.15s,
          color 0.15s;
      }

      #downloadAccordions li:hover {
        background: #2a2a2a;
        color: #ffe5d9; /* peach tone */
      }

      #downloadAccordions li:active {
        background: #333;
      }

      /* --- Download language visual state --- */

      #downloadLangSelect {
        transition:
          box-shadow 0.15s ease,
          border-color 0.15s ease;
      }

      /* ×¡×™××•×Ÿ ×¢×“×™×Ÿ ×œ×¤×™ ×©×¤×” */
      #downloadLangSelect.lang-he-en {
        box-shadow: 0 0 0 2px rgba(187, 247, 208, 0.5); /* forest */
      }
      #downloadLangSelect.lang-pl-en {
        box-shadow: 0 0 0 2px rgba(255, 229, 217, 0.55); /* peach */
      }
      #downloadLangSelect.lang-ar-he {
        box-shadow: 0 0 0 2px rgba(255, 237, 213, 0.55); /* sunset */
      }
      #downloadLangSelect.lang-es-he {
        box-shadow: 0 0 0 2px rgba(187, 247, 208, 0.35); /* forest soft */
      }
      .li-available {
        background: linear-gradient(180deg, #bbf7d0, #22c55e);
        color: #052e16;
        font-weight: 700;
      }

      .li-locked {
        opacity: 0.35;
        cursor: not-allowed;
      }

      /* ---------- DOWNLOAD STRUCTURE ---------- */

      .download-lang-box {
        background: linear-gradient(180deg, #1f2933, #161c22);
        border: 2px solid #6fa8dc;
        border-radius: 16px;
        padding: 14px;
        margin-bottom: 16px;
        box-shadow: 0 6px 14px rgba(0, 0, 0, 0.35);
      }

      .download-lang-title {
        font-size: 14px;
        font-weight: 700;
        letter-spacing: 0.4px;
        margin-bottom: 8px;
        color: #9fc5ff;
        text-align: center;
      }

      .download-divider {
        height: 1px;
        background: linear-gradient(
          to right,
          transparent,
          #6fa8dc,
          transparent
        );
        margin: 10px 0 14px;
        opacity: 0.8;
      }

      .download-topics-title {
        font-size: 14px;
        font-weight: 700;
        letter-spacing: 0.4px;
        margin-bottom: 8px;
        color: #ffd966;
        text-align: center;
      }

    /* === ACCORDION â€“ COLORFUL === */

.accordion {
  margin-bottom: 14px;
  border-radius: 16px;
  overflow: hidden;
  box-shadow: 0 6px 14px rgba(0,0,0,.45);
}

/* ===== HEADER / BRANCH ===== */
.accordion-header {
  padding: 14px 16px;
  font-size: 18px;
  font-weight: 800;
  letter-spacing: .4px;

  display: flex;
  justify-content: space-between;
  align-items: center;

  cursor: pointer;

  background: linear-gradient(180deg, #60a5fa, #2563eb);
  color: #04142e;

  transition: filter .2s, box-shadow .2s;
}

.accordion-header:hover {
  filter: brightness(1.05);
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.35);
}

.accordion-header span {
  font-size: 15px;
  opacity: .7;
  transition: transform .25s ease, opacity .2s;
}

.accordion.open .accordion-header span {
  transform: rotate(90deg);
  opacity: 1;
}

/* ===== CONTENT ===== */
.accordion-content {
  max-height: 0;
  overflow: hidden;
  opacity: 0;
  background: linear-gradient(180deg, #0f172a, #020617);

  transition:
    max-height .35s ease,
    opacity .25s ease;
}

.accordion.open .accordion-content {
  max-height: 900px;
  opacity: 1;
}

/* ===== GROUP ===== */
.download-group {
  padding: 12px 16px 6px;
  border-top: 1px solid rgba(255,255,255,.08);
}

.download-group strong {
  display: block;
  font-size: 14px;
  margin-bottom: 8px;
  color: #fde68a; /* warm yellow */
  letter-spacing: .3px;
}

/* ===== FILE LIST ===== */
.accordion-content ul {
  list-style: none;
  padding: 0;
  margin: 0;
}

.accordion-content li {
  padding: 10px 12px;
  margin-bottom: 6px;
  border-radius: 10px;

  font-size: 15px;
  font-weight: 600;

  background: linear-gradient(180deg, #ecfeff, #cffafe);
  color: #083344;

  box-shadow: 0 2px 6px rgba(0,0,0,.25);
  cursor: pointer;

  transition:
    transform .1s,
    box-shadow .15s,
    filter .15s;
}

.accordion-content li:hover {
  filter: brightness(1.05);
  box-shadow: 0 6px 14px rgba(0,0,0,.35);
}

.accordion-content li:active {
  transform: translateY(1px);
  box-shadow: 0 3px 6px rgba(0,0,0,.4);
}

      /* ---------- LIST ---------- */

      #bankListTopicSelect {
        width: 100%;
        padding: 12px;
        margin-bottom: 10px;
        font-size: 16px;

        border-radius: 10px;
        border: none;
        box-sizing: border-box;

        position: relative;
        z-index: 10; /* ğŸ”¥ ×§×¨×™×˜×™ */
      }

      .list-item {
        background: #222;
        padding: 17px;
        margin: 8px 0;
        border-radius: 10px;
      }

      .word-line {
        font-size: 33px;
        font-weight: 600;
        line-height: 1.3;
      }

      .actions {
        display: flex;
        gap: 8px;
      }

      .actions button {
        width: 50%;
      }

      /* ---------- CONTACT ---------- */
      .contact button {
        background: linear-gradient(180deg, #e6e6e6, #efcfcf);
        color: #222;
        font-weight: 700;
      }

      .about-box {
        border: 2px solid #9fa8dc;
        border-radius: 18px;
        padding: 16px;
        margin-top: 20px;
        background: #1c1c1c;
        text-align: center;
      }

      .about-title {
        font-size: 22px;
        font-weight: 800;
        margin-bottom: 10px;
        color: #9fc5ff;
      }

      .about-box p {
        margin: 10px 0;
        font-size: 15px;
        line-height: 1.4;
      }

      .stat-block {
        background: #1c1c1c;
        padding: 10px;
        margin: 8px 0;
        border-radius: 10px;
      }

      /* ---------- CONTACT   LINKS ---------- */
      .contact-links {
        display: flex;
        flex-direction: column;
        gap: 12px;
        margin: 16px 0;
      }

      .contact-links a {
        display: block;
        text-align: center;
        padding: 14px;
        border-radius: 14px;
        font-size: 16px;
        font-weight: 700;
        color: #fff;
        text-decoration: none;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.25);
        transition:
          opacity 0.2s,
          transform 0.1s;
      }

      .contact-links a:hover {
        opacity: 0.9;
      }

      .contact-links a:active {
        transform: translateY(2px);
      }

      /* Colors */
      .contact-links a.facebook {
        background: #1877f2;
      }

      .contact-links a.instagram {
        background: linear-gradient(45deg, #f58529, #dd2a7b, #8134af);
      }

      .contact-links a.whatsapp {
        background: #25d366;
      }

      .contact-links a.email {
        background: #6b7280;
      }

      /* --- HARD WORDS TABLE --- */
      .hard-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
      }
      .hard-table th {
        text-align: left;
        padding: 8px;
        border-bottom: 2px solid #555;
        font-size: 16px;
      }
      .hard-table td {
        padding: 10px 8px;
        border-bottom: 1px solid #333;
        vertical-align: top;
      }
      .hard-word {
        font-size: 20px;
        font-weight: 600;
      }
      .hard-count {
        text-align: center;
        font-size: 18px;
      }

      .sound-toggle {
        text-align: center;
        font-size: 22px;
        margin: 10px 0 6px;
        cursor: pointer;
        user-select: none;
        opacity: 0.85;
      }
      .sound-toggle:hover {
        opacity: 1;
      }

      #sessionEnd.active {
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .session-end-box {
        text-align: center;
        max-width: 320px;
      }

      .session-end-box h1 {
        font-size: 36px;
        margin-bottom: 10px;
      }

      .session-end-sub {
        font-size: 18px;
        opacity: 0.85;
        margin-bottom: 24px;
      }

/* ===== RESET / BASICS ===== */
* {
  box-sizing: border-box;
}

body {
  margin: 0;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
    Roboto, Helvetica, Arial, sans-serif;
}

/* ===== SESSION SCREEN ===== */
#session {
  padding: 12px;
  box-sizing: border-box;
}


/* ===== SESSION BUTTONS ===== */
.session-buttons button {
  border: none;
  border-radius: 14px;
  padding: 14px 18px;
  font-size: 16px;
  font-weight: 600;
  color: #ffffff;
  cursor: pointer;

  box-shadow: 0 6px 18px rgba(0, 0, 0, 0.18);
  transition: transform 0.15s ease, box-shadow 0.15s ease;
}

.session-buttons button:hover {
  transform: translateY(-2px);
  box-shadow: 0 10px 26px rgba(0, 0, 0, 0.22);
}

.session-buttons button:active {
  transform: scale(0.97);
}

/* ===== I KNEW IT â€” ×ª××™×“ ×™×¨×•×§ ===== */
#knownBtn {
  background: #22c55e; /* ×™×¨×•×§ ×§×‘×•×¢ */
  color: #ffffff;
}

#knownBtn:hover {
  background: #16a34a;
}

#knownBtn:active {
  background: #15803d;
}

#knownBtn:disabled {
  background: #22c55e;
  opacity: 0.6;
}

/* ===== I DIDNâ€™T KNOW IT ===== */
#unknownBtn {
  background: #ef4444;
}

#unknownBtn:hover {
  background: #dc2626;
}

#unknownBtn:active {
  background: #b91c1c;
}

/* ===== HOME BUTTONS ===== */
.home-btn {
  border: none;
  color: #ffffff;
  font-weight: 600;
  padding: 14px 18px;
  border-radius: 16px;
  font-size: 17px;
  cursor: pointer;

  box-shadow: 0 8px 22px rgba(0, 0, 0, 0.2);
  transition: transform 0.15s ease, box-shadow 0.15s ease;
}

.home-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 14px 30px rgba(0, 0, 0, 0.25);
}

.home-btn:active {
  transform: scale(0.96);
}

/* ×¦×‘×¢×™× ×—×™×™× ×œ×“×£ ×”×‘×™×ª */
.home-start {
  background: linear-gradient(180deg, #f1f4f8, #dfe7f1);

    </style>

  </head>

  <body>
    <!-- HOME -->
    <div class="screen active" id="home">
      <div class="welcome">WELCOME</div>
      <br />

      <div id="instructions" class="instructions">
        To start, add words OR load a file in the Word Bank
      </div>

      <select id="topicSelect"></select>
      <button
        class="button-primary"
        onclick="startSessionSafe(topicSelect.value)"
      >
        Start Session
      </button>

      <button class="peach" onclick="showBank()">Word Bank</button>
      <button class="lavender" onclick="showStats()">Statistics</button>
      <button class="forest" onclick="showContact()">Contact</button>
      <button onclick="exitApp()" class="back">Exit</button>

      <div class="title-bottom">Hebrew with MotiVation</div>
      <div style="text-align: center; opacity: 0.4">TEST - 85</div>

      <div
        id="cacheVersion"
        style="
          text-align: center;
          font-size: 13px;
          opacity: 0.5;
          margin-top: 20px;
        "
      ></div>
    </div>

    <!-- RESET -->
    <div class="screen" id="resetGate">
      <h2>Update</h2>

      <button class="SUNSET" onclick="hardReset()">Reset App</button>
    </div>

    <!-- BANK -->
    <div class="screen" id="bank">
      <h2>Word Bank</h2>
      <select id="bankTopicSelect"></select>
      <button class="sunset" onclick="showAdd()">Add words / topic</button>

      <div class="word-files-invite">
        <button class="invite-cta" onclick="showDownload()">
          Word Library
        </button>
      </div>

      <button class="peach" onclick="triggerImport()">Import word file</button>

      <button onclick="goHome()" class="back">Back</button>
    </div>

    <!-- ACCORDIONS  -->
    <div class="screen" id="download">
      <h2>WORD LIBRARY</h2>

      <div class="download-lang-box">
        <div class="download-lang-title">Choose language</div>

        <select id="downloadLangSelect">
          <option value="" hidden>Choose language pair</option>
          <option value="he-en">Hebrew â†’ English</option>
          <option value="pl-en">Polish â†’ English</option>
          <option value="ar-he">Arabic â†’ Hebrew</option>
          <option value="es-he">Spanish â†’ Hebrew</option>
        </select>
      </div>

      <div class="download-divider"></div>

      <div class="download-topics-title">Choose topic</div>

      <div id="downloadAccordions"></div>

      <button class="back" onclick="goHome()">Back</button>
    </div>

    <!-- BANK LIST -->

    <div class="screen" id="bankList">
      <select
        id="bankListTopicSelect"
        onchange="switchBankListTopic()"
      ></select>

      <button onclick="addWordToCurrentTopic()" class="forest">
        + Add word
      </button>

      <button class="lavender" onclick="exportCurrentTopic()">
        Export word file
      </button>

      <div style="display: flex; gap: 8px">
        <button class="peach" style="flex: 1" onclick="renameCurrentTopic()">
          Rename
        </button>
        <button
          id="deleteTopicBtn"
          class="button-danger"
          style="flex: 1"
          onclick="deleteCurrentTopic()"
        >
          Delete
        </button>
      </div>

      <button class="back" style="font-weight: 700" onclick="goHome()">
        Back
      </button>

      <input
        id="searchInput"
        placeholder="Search..."
        oninput="renderWordList()"
      />
      <select id="sortSelect" onchange="renderWordList()">
        <option value="">No sorting</option>
        <option value="learn">By learning language</option>
        <option value="tr">By translation</option>
      </select>

      <div id="wordList"></div>

      <button onclick="showBank()" class="back">Back</button>
    </div>

    <!-- ADD -->
    <div class="screen" id="add">
      <h2>Add word</h2>
      <select id="addTopicSelect" onchange="onAddTopicChange()"></select>
      <input id="newTopicInput" class="hidden" placeholder="New topic name" />
      <textarea id="learnInput" placeholder="Learning language"></textarea>
      <textarea id="translationInput" placeholder="Translation"></textarea>
      <button class="forest" onclick="saveWord()">Save</button>
      <button onclick="goHome()" class="back">Back</button>
    </div>

    <!-- SESSION -->
    <div class="screen" id="session">
      <div class="flip-hint">CLICK TO FLIP</div>

      <div class="card-frame">
        <div class="card" id="card" onclick="flipCard()"></div>
      </div>

      <div class="remaining">Remaining: <span id="remainingCount"></span></div>

      <div class="sound-toggle" onclick="toggleSound()" id="soundIcon">ğŸ”Š</div>

      <div class="row">
        <button class="forest" onclick="markKnown()">I knew it</button>
        <button class="button-danger" onclick="markUnknown()">Ooooopsi</button>
      </div>

      <button class="lavender" id="shuffleBtn" onclick="shuffleSession()">
        Shuffle
      </button>
      <button class="sunset" onclick="flipDirection()">Flip Direction</button>
      <button onclick="exitSessionSafe('home')" class="back">Exit</button>
    </div>

    <!-- SESSION END -->
    <div class="screen" id="sessionEnd">
      <div class="session-end-box">
        <h1>ğŸ‰ Well done ğŸ‰</h1>
        <p class="session-end-sub">Youâ€™ve completed the session</p>

        <button class="forest" id="restartSessionBtn">Start again</button>

        <button onclick="exitSessionSafe('home')" class="back">Exit</button>
      </div>
    </div>

    <!-- STATS -->
    <div class="screen" id="stats">
      <button onclick="resetStats()" class="button-danger">
        Reset statistics
      </button>
      <button onclick="goHome()" class="back">Back</button>
      <div id="statsContent"></div>
      <button onclick="goHome()" class="back">Back</button>
    </div>

    <!-- CONTACT -->
    <div class="screen contact" id="contact">
      <div class="about-box">
        <div class="about-title">Hebrew with Moti Vation</div>

        <p>
          I'm here â€“ No Fear<br />
          Hebrew will become so clear
        </p>

        <p>
          Online sessions from the comfort of your home<br />
          Beginners / Advanced / Individuals / Groups
        </p>

        <p>
          Fun & Interesting lessons<br />
          I love languages and I love teaching
        </p>

        <p>
          Lets go on adventure..<br />
          Cake Eat Easy<br />
          Take care â€“ Take air
        </p>
      </div>

      <div class="contact-links">
        <a
          class="facebook"
          href="https://www.facebook.com/share/1D6uJLL5nK/"
          target="_blank"
        >
          Facebook
        </a>

        <a
          class="instagram"
          href="https://www.instagram.com/hebrew_with_motivation"
          target="_blank"
        >
          Instagram
        </a>

        <a class="email" href="mailto:mottex@gmail.com"> Email </a>

        <a class="whatsapp" href="https://wa.me/48604726360" target="_blank">
          WhatsApp
        </a>
      </div>

      <button onclick="goHome()" class="back">Back</button>
    </div>

    <input type="file" id="importFile" accept=".csv" class="hidden" />


    
    <script src="hubIndex.js?v=555"></script><script src="hubIndex.js?v=555"></script>
<script>
/* =========================================================
   STORAGE / VERSION
========================================================= */
const STORAGE_VERSION = "v555";
const FLASH_KEY = `flashData_${STORAGE_VERSION}`;
const STATS_KEY = `stats_${STORAGE_VERSION}`;
const RESET_FLAG = "APP_RESET_DONE_v555";

/*
APP_VERSION_KEY:
- forces full reset when app version changes (breaking storage changes)
RESET_FLAG:
- gates UI until user explicitly resets once
Both are intentionally kept.
*/
const APP_VERSION = 555;
const APP_VERSION_KEY = "app_version";

if ("scrollRestoration" in history) {
  history.scrollRestoration = "manual";
}

/* =========================================================
   DOM (SINGLE SOURCE OF TRUTH)
========================================================= */
const topicSelect = document.getElementById("topicSelect");
const bankTopicSelect = document.getElementById("bankTopicSelect");
const bankListTopicSelect = document.getElementById("bankListTopicSelect");
const searchInput = document.getElementById("searchInput");
const sortSelect = document.getElementById("sortSelect");
const wordList = document.getElementById("wordList");
const addTopicSelect = document.getElementById("addTopicSelect");
const learnInput = document.getElementById("learnInput");
const translationInput = document.getElementById("translationInput");
const newTopicInput = document.getElementById("newTopicInput");
const importFile = document.getElementById("importFile");
const shuffleBtn = document.getElementById("shuffleBtn");
const card = document.getElementById("card");
const statsContent = document.getElementById("statsContent");
const deleteTopicBtn = document.getElementById("deleteTopicBtn");
const downloadLangSelect = document.getElementById("downloadLangSelect");

/* =========================================================
   SOUND
========================================================= */
let soundOn = JSON.parse(localStorage.getItem("soundOn") ?? "true");

const flipSound = new Audio(
  "https://actions.google.com/sounds/v1/impacts/metal_parts_cling.ogg"
);
const correctSound = new Audio(
  "https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg"
);

flipSound.volume = 0.2;
correctSound.volume = 0.07;

function updateSoundIcon() {
  const el = document.getElementById("soundIcon");
  if (el) el.textContent = soundOn ? "ğŸ”Š" : "ğŸ”‡";
}

function toggleSound() {
  soundOn = !soundOn;
  localStorage.setItem("soundOn", JSON.stringify(soundOn));
  updateSoundIcon();
}

/* =========================================================
   DATA / HELPERS
========================================================= */
let returnToTopicAfterSave = null;
let lastAddTopic = null;
let currentTopic = null;

function uuid() {
  if (typeof crypto !== "undefined" && crypto.randomUUID) {
    return crypto.randomUUID();
  }
  return `id-${Date.now()}-${Math.random().toString(16).slice(2)}`;
}

function createTopic(title, source = "local", hubMeta = null) {
  return { id: uuid(), title, source, hubMeta, words: [] };
}

let data = JSON.parse(localStorage.getItem(FLASH_KEY)) || {
  topics: {}
};

let stats = JSON.parse(localStorage.getItem(STATS_KEY)) || {
  sessions: 0,
  history: [],
  perTopic: {},
  hardWords: {},
  current: null
};

function saveData() {
  localStorage.setItem(FLASH_KEY, JSON.stringify(data));
}

function saveStats() {
  localStorage.setItem(STATS_KEY, JSON.stringify(stats));
}

/* =========================================================
   TOPIC NAME GATE (SINGLE)
========================================================= */
function normalizeTopicName(name) {
  return name.trim().replace(/\s+/g, " ").toLowerCase();
}

function isTopicTitleAvailable(title, excludeId = null) {
  const norm = normalizeTopicName(title);
  return !Object.values(data.topics).some(t =>
    t.id !== excludeId && normalizeTopicName(t.title) === norm
  );
}

/* =========================================================
   TOPICS / BANK
========================================================= */
function setCurrentTopic(topicId) {
  currentTopic = topicId || null;
  if (topicSelect) topicSelect.value = currentTopic || "";
  if (bankTopicSelect) bankTopicSelect.value = currentTopic || "";
  if (bankListTopicSelect) bankListTopicSelect.value = currentTopic || "";
}

function allWords() {
  let a = [];
  Object.values(data.topics).forEach(t => a.push(...t.words));
  return a;
}

function loadTopics() {
  const topics = Object.values(data.topics);

  topicSelect.innerHTML = '<option value="">Select topic</option>';
  topics.forEach(t => {
    topicSelect.innerHTML += `<option value="${t.id}">${t.title}</option>`;
  });

  bankTopicSelect.innerHTML = '<option value="">Select topic</option>';
  bankListTopicSelect.innerHTML = "";

  topics.forEach(t => {
    bankTopicSelect.innerHTML += `<option value="${t.id}">${t.title}</option>`;
    bankListTopicSelect.innerHTML += `<option value="${t.id}">${t.title}</option>`;
  });
}

/* =========================================================
   EXPORT (FIXED)
========================================================= */
function exportCurrentTopic() {
  const topic = data.topics[currentTopic];
  if (!topic) return;

  let rows = ["Learning language,Translation"];
  topic.words.forEach(w => {
    rows.push(`"${w.learn}","${w.tr}"`);
  });

  const blob = new Blob([rows.join("\n")], { type: "text/csv" });
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = `${topic.title}.csv`;
  a.click();
}

/* =========================================================
   RESET / VERSION GATE
========================================================= */
(function bootstrapVersionGate() {
  const stored = Number(localStorage.getItem(APP_VERSION_KEY));
  if (stored !== APP_VERSION) {
    localStorage.clear();
    localStorage.setItem(APP_VERSION_KEY, APP_VERSION);
    localStorage.setItem(RESET_FLAG, "1");
  }
})();

/* =========================================================
   NAV / SCREENS (REQUIRED FOR inline onclick)
========================================================= */
function show(id) {
  document
    .querySelectorAll(".screen")
    .forEach(s => s.classList.remove("active"));
  document.getElementById(id)?.classList.add("active");
}

function showBank() {
  loadTopics();
  show("bank");
}

function showStats() {
  renderStats();
  show("stats");
}

function goHome() {
  show("home");
}


function startSessionSafe(topicId) {
  if (!topicId) return;
  setCurrentTopic(topicId);
  startSession(); // ××©×ª××© ×‘×œ×•×’×™×§×” ×”×§×™×™××ª ×©×œ×š
}


/* =========================================================
   INIT
========================================================= */
(function startApp() {
  loadTopics();
  updateSoundIcon();
})();



/* =========================================================
   GLOBAL EXPORTS (inline onclick support)
========================================================= */
window.startSessionSafe = startSessionSafe;
window.showBank = showBank;
window.showStats = showStats;
window.goHome = goHome;
window.toggleSound = toggleSound;

</script>

  </body>
</html>
