<!doctype html>
<html lang="en">
  <head>

    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Hebrew with MotiVation</title>

    <style>
      .hidden {
        display: none;
      }

      body {
        margin: 0;
        font-family: system-ui, sans-serif;
        background: #111;
        color: #fff;

        font-size: 17px;
        line-height: 1.55;
        letter-spacing: 0.3px;
      }

      /* ---------- SCREENS ---------- */
      .screen {
        display: none;
        padding: 18px;
        max-width: 420px;
        margin: auto;
        min-height: 100vh;
        box-sizing: border-box;
      }
      .screen.active {
        display: block;
      }

      /* ---------- HOME ---------- */
      .welcome {
        font-size: 40px;
        font-weight: 800;
        text-align: center;
        margin-top: 35px;
      }
      .instructions {
        text-align: center;
        font-size: 25px;
        margin: 20px 0 30px;
        color: #bbb;
      }
      .title-bottom {
        text-align: center;
        font-size: 30px;
        margin-top: 28px;
        opacity: 0.85;
      }

      /* ---------- BUTTONS ---------- */
      button {
        width: 100%;
        padding: 14px;
        margin: 8px 0;
        font-size: 17px;
        font-weight: 600;
        letter-spacing: 0.3px;
        border: none;
        border-radius: 14px;
        cursor: pointer;
        background: linear-gradient(180deg, #f1f4f8, #dfe7f1);
        color: #222;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.25);
        transition:
          transform 0.1s,
          box-shadow 0.1s,
          background 0.2s;
      }
      button:hover {
        background: linear-gradient(180deg, #ffffff, #e6eef8);
      }
      button:active {
        transform: translateY(2px);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.35);
      }

      .forest {
        background: linear-gradient(180deg, #bbf7d0, #22c55e);
        color: #052e16;
      }

      .back {
        background: linear-gradient(180deg, #e0e0e0, #cfcfcf);
      }
      .button-danger {
        background: linear-gradient(180deg, #ff9aa2, #ff6f6f);
        color: #300;
      }

      .button-primary {
        background: linear-gradient(180deg, #9fc5ff, #6fa8ff);
        color: #002b5c;
      }

      .button-success {
        background: linear-gradient(180deg, #b7e4c7, #95d5b2);
        color: #103b24;
      }

      .button-bank {
        background: linear-gradient(180deg, #b7e4c7, #95d5b2);
        color: #103b24;
      }

      .peach {
        background: linear-gradient(180deg, #ffe5d9, #ffb4a2);
        color: #5a1f14;
      }
      .sunset {
        background: linear-gradient(180deg, #ffedd5, #fb923c);
        color: #4a1d00;
      }

      .lavender {
        background: linear-gradient(180deg, #ede9fe, #c4b5fd);
        color: #2e1065;
      }

      /* ---------- FORM ---------- */
      select,
      input,
      textarea {
        width: 100%;
        padding: 13px;
        margin: 8px 0;
        font-size: 17px;
        border-radius: 10px;
        border: none;
        box-sizing: border-box;
      }

      /* ---------- SESSION ---------- */

      .flip-hint {
        text-align: center;
        font-family: "Comic Sans MS", "Trebuchet MS", cursive;
        font-size: 30px;
        margin-bottom: 10px;
        color: #ffd966;
      }

      .card-frame {
        border: 5px solid #6fa8dc;
        border-radius: 18px;
        padding: 14px;
        background: #2a2a2a;
        box-shadow:
          0 10px 18px rgba(0, 0, 0, 0.6),
          inset 0 0 0 2px rgba(255, 255, 255, 0.08);
      }

      .card {
        background: #111;
        height: 220px; /* ×›×¨×˜×™×¡ ×§×‘×•×¢ */
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 102px; /* ×¤×™ 3 */
        line-height: 1.15;
        text-align: center;
        border-radius: 12px;
        padding: 20px;
        user-select: none;

        overflow: hidden; /* ×”×›×¨×˜×™×¡ ×œ× ×’×“×œ */
        white-space: normal; /* ×ž×•×ª×¨ ×œ×©×‘×•×¨ ×©×•×¨×” */
        word-break: normal; /* âŒ ×œ× ×©×•×‘×¨×™× ×ž×™×œ×” */
        overflow-wrap: normal; /* âŒ ×œ× ×©×•×‘×¨×™× ×ž×™×œ×” */
      }

      .remaining {
        text-align: center;
        font-size: 20px;
        margin-top: 10px;
        color: #cfe2f3;
      }

      .row {
        display: flex;
        gap: 10px;
        margin-top: 14px;
      }
      .row button {
        width: 50%;
      }

      /* ---------- BANK ---------- */

      .word-files-invite {
        border: 2px solid #ffd966;
        border-radius: 18px;
        padding: 16px;
        margin: 16px 0;
        background: linear-gradient(180deg, #1f1f1f, #151515);
        box-shadow: 0 0 18px rgba(255, 217, 102, 0.25);
      }
      .word-files-invite h3 {
        text-align: center;
        font-size: 22px;
        color: #ffe599;
        margin-bottom: 6px;
      }
      .invite-main {
        text-align: center;
        font-size: 15px;
        margin-bottom: 10px;
      }
      .invite-cta {
        text-align: center;
        font-size: 17px;
        font-weight: 700;
        letter-spacing: 0.3px;
        padding: 12px;
        border-radius: 14px;
        background: linear-gradient(180deg, #9fc5ff, #6fa8ff);
        color: #002b5c;
        cursor: pointer;

        transition:
          transform 0.15s ease,
          box-shadow 0.15s ease,
          opacity 0.15s ease;
      }

      .invite-cta:hover {
        transform: translateY(-1px);
        box-shadow: 0 6px 14px rgba(0, 0, 0, 0.25);
        opacity: 0.95;
      }

      .invite-cta:active {
        transform: translateY(1px);
        box-shadow: 0 3px 6px rgba(0, 0, 0, 0.35);
      }

      /* ---------- DOWNLOAD ---------- */

      #download select {
        margin-bottom: 14px;
        background: #1c1c1c;
        color: #fff;
      }

      #download h2 {
        text-align: center;
        margin-bottom: 14px;
      }

      #downloadAccordions li {
        cursor: pointer;
        padding: 8px 6px;
        border-radius: 8px;
        transition:
          background 0.15s,
          color 0.15s;
      }

      #downloadAccordions li:hover {
        background: #2a2a2a;
        color: #ffe5d9; /* peach tone */
      }

      #downloadAccordions li:active {
        background: #333;
      }

      /* --- Download language visual state --- */

      #downloadLangSelect {
        transition:
          box-shadow 0.15s ease,
          border-color 0.15s ease;
      }

      /* ×¡×™×ž×•×Ÿ ×¢×“×™×Ÿ ×œ×¤×™ ×©×¤×” */
      #downloadLangSelect.lang-he-en {
        box-shadow: 0 0 0 2px rgba(187, 247, 208, 0.5); /* forest */
      }
      #downloadLangSelect.lang-pl-en {
        box-shadow: 0 0 0 2px rgba(255, 229, 217, 0.55); /* peach */
      }
      #downloadLangSelect.lang-ar-he {
        box-shadow: 0 0 0 2px rgba(255, 237, 213, 0.55); /* sunset */
      }
      #downloadLangSelect.lang-es-he {
        box-shadow: 0 0 0 2px rgba(187, 247, 208, 0.35); /* forest soft */
      }
      .li-available {
        background: linear-gradient(180deg, #bbf7d0, #22c55e);
        color: #052e16;
        font-weight: 700;
      }

      .li-locked {
        opacity: 0.35;
        cursor: not-allowed;
      }

      /* ---------- DOWNLOAD STRUCTURE ---------- */

      .download-lang-box {
        background: linear-gradient(180deg, #1f2933, #161c22);
        border: 2px solid #6fa8dc;
        border-radius: 16px;
        padding: 14px;
        margin-bottom: 16px;
        box-shadow: 0 6px 14px rgba(0, 0, 0, 0.35);
      }

      .download-lang-title {
        font-size: 14px;
        font-weight: 700;
        letter-spacing: 0.4px;
        margin-bottom: 8px;
        color: #9fc5ff;
        text-align: center;
      }

      .download-divider {
        height: 1px;
        background: linear-gradient(
          to right,
          transparent,
          #6fa8dc,
          transparent
        );
        margin: 10px 0 14px;
        opacity: 0.8;
      }

      .download-topics-title {
        font-size: 14px;
        font-weight: 700;
        letter-spacing: 0.4px;
        margin-bottom: 8px;
        color: #ffd966;
        text-align: center;
      }

      /* ---------- ACCORDION ---------- */

      #downloadAccordions.lang-not-selected {
        opacity: 0.4;
        pointer-events: none;
      }

      .accordion {
        border-radius: 14px;
        background: #1c1c1c;
        margin-bottom: 10px;
        overflow: hidden;
      }

      .accordion-header {
        padding: 14px;
        font-size: 18px;
        font-weight: 700;
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .accordion-header span {
        transition: transform 0.25s ease;
      }

      .accordion.open .accordion-header span {
        transform: rotate(90deg);
      }

      .accordion-content {
        max-height: 0;
        overflow: hidden;
        opacity: 0;
        transform: translateY(-4px);
        transition:
          max-height 0.35s ease,
          opacity 0.25s ease,
          transform 0.25s ease;
      }

      .accordion.open .accordion-content {
        max-height: 1000px;
        opacity: 1;
        transform: translateY(0);
        padding-bottom: 12px;
      }

      .accordion-content ul {
        margin: 0;
        padding-left: 18px;
        font-size: 14px;
        line-height: 1.45;
      }

      .accordion-has-files > .accordion-header {
        background: linear-gradient(180deg, #bbf7d0, #22c55e);
        color: #052e16;
      }

      /* ---------- LIST ---------- */

      #bankListTopicSelect {
        width: 100%;
        padding: 12px;
        margin-bottom: 10px;
        font-size: 16px;

        border-radius: 10px;
        border: none;
        box-sizing: border-box;

        position: relative;
        z-index: 10; /* ðŸ”¥ ×§×¨×™×˜×™ */
      }

      .list-item {
        background: #222;
        padding: 17px;
        margin: 8px 0;
        border-radius: 10px;
      }

      .word-line {
        font-size: 33px;
        font-weight: 600;
        line-height: 1.3;
      }

      .actions {
        display: flex;
        gap: 8px;
      }

      .actions button {
        width: 50%;
      }

      /* ---------- CONTACT ---------- */
      .contact button {
        background: linear-gradient(180deg, #e6e6e6, #cfcfcf);
        color: #222;
        font-weight: 700;
      }

      .about-box {
        border: 2px solid #6fa8dc;
        border-radius: 18px;
        padding: 16px;
        margin-top: 20px;
        background: #1c1c1c;
        text-align: center;
      }

      .about-title {
        font-size: 22px;
        font-weight: 800;
        margin-bottom: 10px;
        color: #9fc5ff;
      }

      .about-box p {
        margin: 10px 0;
        font-size: 15px;
        line-height: 1.4;
      }

      .stat-block {
        background: #1c1c1c;
        padding: 10px;
        margin: 8px 0;
        border-radius: 10px;
      }

      /* ---------- CONTACT   LINKS ---------- */
      .contact-links {
        display: flex;
        flex-direction: column;
        gap: 12px;
        margin: 16px 0;
      }

      .contact-links a {
        display: block;
        text-align: center;
        padding: 14px;
        border-radius: 14px;
        font-size: 16px;
        font-weight: 700;
        color: #fff;
        text-decoration: none;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.25);
        transition:
          opacity 0.2s,
          transform 0.1s;
      }

      .contact-links a:hover {
        opacity: 0.9;
      }

      .contact-links a:active {
        transform: translateY(2px);
      }

      /* Colors */
      .contact-links a.facebook {
        background: #1877f2;
      }

      .contact-links a.instagram {
        background: linear-gradient(45deg, #f58529, #dd2a7b, #8134af);
      }

      .contact-links a.whatsapp {
        background: #25d366;
      }

      .contact-links a.email {
        background: #6b7280;
      }

      /* --- HARD WORDS TABLE --- */
      .hard-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
      }
      .hard-table th {
        text-align: left;
        padding: 8px;
        border-bottom: 2px solid #555;
        font-size: 16px;
      }
      .hard-table td {
        padding: 10px 8px;
        border-bottom: 1px solid #333;
        vertical-align: top;
      }
      .hard-word {
        font-size: 20px;
        font-weight: 600;
      }
      .hard-count {
        text-align: center;
        font-size: 18px;
      }

      .sound-toggle {
        text-align: center;
        font-size: 22px;
        margin: 10px 0 6px;
        cursor: pointer;
        user-select: none;
        opacity: 0.85;
      }
      .sound-toggle:hover {
        opacity: 1;
      }

      #sessionEnd.active {
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .session-end-box {
        text-align: center;
        max-width: 320px;
      }

      .session-end-box h1 {
        font-size: 36px;
        margin-bottom: 10px;
      }

      .session-end-sub {
        font-size: 18px;
        opacity: 0.85;
        margin-bottom: 24px;
      }
    </style>
  </head>

  <body>
    <!-- HOME -->
    <div class="screen active" id="home">
      <div class="welcome">WELCOME</div>
      <br />

      <div id="instructions" class="instructions">
        To start, add words OR load a file in the Word Bank
      </div>

      <select id="topicSelect"></select>
      <button class="button-primary" onclick="startSession()">
        Start A sessioN
      </button>
      <button class="peach" onclick="showBank()">Word Bank</button>
      <button class="lavender" onclick="showStats()">Statistics</button>
      <button class="forest" onclick="showContact()">Contact</button>
      <button onclick="exitApp()" class="back">Exit</button>

      <div class="title-bottom">Hebrew with MotiVation</div>

      <div
        id="cacheVersion"
        style="
          text-align: center;
          font-size: 13px;
          opacity: 0.5;
          margin-top: 20px;
        "
      ></div>
    </div>


<!-- RESET -->
<div class="screen" id="resetGate">
  <h2>Update</h2>

  <button class="SUNSET" onclick="hardReset()">
    Reset App
  </button>
</div>


    <!-- BANK -->
    <div class="screen" id="bank">
      <h2>Word Bank</h2>
      <select id="bankTopicSelect"></select>
      <button class="sunset" onclick="showAdd()">Add words / topic</button>

      <div class="word-files-invite">
        <button class="invite-cta" onclick="showDownload()">
          Word Library
        </button>
      </div>

      <button class="peach" onclick="triggerImport()">Import word file</button>

      <button onclick="goHome()" class="back">Back</button>
    </div>

    <!-- ACCORDIONS  -->
    <div class="screen" id="download">
      <h2>WORD LIBRARY</h2>

      <div class="download-lang-box">
        <div class="download-lang-title">Choose language</div>

        <select id="downloadLangSelect">
          <option value="" hidden>Choose language pair</option>
          <option value="he-en">Hebrew â†’ English</option>
          <option value="pl-en">Polish â†’ English</option>
          <option value="ar-he">Arabic â†’ Hebrew</option>
          <option value="es-he">Spanish â†’ Hebrew</option>
        </select>
      </div>

      <div class="download-divider"></div>

      <div class="download-topics-title">Choose topic</div>

      <div id="downloadAccordions"></div>

      <button class="back" onclick="goHome()">Back</button>
    </div>

    <!-- BANK LIST -->

    <div class="screen" id="bankList">
      <select
        id="bankListTopicSelect"
        onchange="switchBankListTopic()"
      ></select>

      <button onclick="addWordToCurrentTopic()" class="forest">
        + Add word
      </button>

      <button class="lavender" onclick="exportCurrentTopic()">
        Export word file
      </button>

      <div style="display: flex; gap: 8px">
        <button class="peach" style="flex: 1" onclick="renameCurrentTopic()">
          Rename
        </button>
        <button
          id="deleteTopicBtn"
          class="button-danger"
          style="flex: 1"
          onclick="deleteCurrentTopic()"
        >
          Delete
        </button>
      </div>

      <button class="back" style="font-weight: 700" onclick="goHome()">
        Back
      </button>

      <input
        id="searchInput"
        placeholder="Search..."
        oninput="renderWordList()"
      />
      <select id="sortSelect" onchange="renderWordList()">
        <option value="">No sorting</option>
        <option value="learn">By learning language</option>
        <option value="tr">By translation</option>
      </select>

      <div id="wordList"></div>

      <button onclick="showBank()" class="back">Back</button>
    </div>

    <!-- ADD -->
    <div class="screen" id="add">
      <h2>Add word</h2>
      <select id="addTopicSelect" onchange="onAddTopicChange()"></select>
      <input id="newTopicInput" class="hidden" placeholder="New topic name" />
      <textarea id="learnInput" placeholder="Learning language"></textarea>
      <textarea id="translationInput" placeholder="Translation"></textarea>
      <button class="forest" onclick="saveWord()">Save</button>
      <button onclick="goHome()" class="back">Back</button>
    </div>

    <!-- SESSION -->
    <div class="screen" id="session">
      <div class="flip-hint">CLICK TO FLIP</div>

      <div class="card-frame">
        <div class="card" id="card" onclick="flipCard()"></div>
      </div>

      <div class="remaining">Remaining: <span id="remainingCount"></span></div>

      <div class="sound-toggle" onclick="toggleSound()" id="soundIcon">ðŸ”Š</div>

      <div class="row">
        <button class="forest" onclick="markKnown()">I knew it</button>
        <button class="button-danger" onclick="markUnknown()">Ooooopsi</button>
      </div>

      <button class="lavender" id="shuffleBtn" onclick="shuffleSession()">
        Shuffle
      </button>
      <button class="sunset" onclick="flipDirection()">Flip Direction</button>
      <button onclick="exitSessionSafe('home')" class="back">Exit</button>

    </div>

    <!-- SESSION END -->
    <div class="screen" id="sessionEnd">
      <div class="session-end-box">
        <h1>ðŸŽ‰ Well done ðŸŽ‰</h1>
        <p class="session-end-sub">Youâ€™ve completed the session</p>

        <button class="forest" id="restartSessionBtn">Start again</button>

        <button onclick="exitSessionSafe('home')" class="back">Exit</button>

      </div>
    </div>

    <!-- STATS -->
    <div class="screen" id="stats">
      <h2>Statistics</h2>
      <button onclick="resetStats()" class="button-danger">
        Reset statistics
      </button>
      <div id="statsContent"></div>
      <button onclick="goHome()" class="back">Back</button>
    </div>

    <!-- CONTACT -->
    <div class="screen contact" id="contact">
      <h2>Contact</h2>

      <div class="about-box">
        <div class="about-title">Hebrew with Moti Vation</div>

        <p>
          I'm here â€“ No Fear<br />
          Hebrew will become so clear
        </p>

        <p>
          Online sessions from the comfort of your home<br />
          Beginners / Advanced / Individuals / Groups
        </p>

        <p>
          Fun & Interesting lessons<br />
          I love languages and I love teaching
        </p>

        <p>
          Lets go on adventure..<br />
          Cake Eat Easy<br />
          Take care â€“ Take air
        </p>
      </div>

      <div class="contact-links">
        <a
          class="facebook"
          href="https://www.facebook.com/share/1D6uJLL5nK/"
          target="_blank"
  
      >
          Facebook
        </a>

        <a
          class="instagram"
          href="https://www.instagram.com/hebrew_with_motivation"
          target="_blank"
        >
          Instagram
        </a>

        <a class="email" href="mailto:mottex@gmail.com"> Email </a>

        <a class="whatsapp" href="https://wa.me/48604726360" target="_blank">
          WhatsApp
        </a>
      </div>

      <button onclick="goHome()" class="back">Back</button>
    </div>

    <input type="file" id="importFile" accept=".csv" class="hidden" />

    <script src="hubIndex.js"></script>
    

    <script>

 /* ===== STORAGE CONSTANTS ===== */
const STORAGE_VERSION = "v333";
const FLASH_KEY = `flashData_${STORAGE_VERSION}`;
const STATS_KEY = `stats_${STORAGE_VERSION}`;
const RESET_FLAG = "APP_RESET_DONE_v333";



      /* ===== SOUND ===== */

      let soundOn = JSON.parse(localStorage.getItem("soundOn") ?? "true");
      // very soft sounds

      const flipSound = new Audio(
        "https://actions.google.com/sounds/v1/impacts/metal_parts_cling.ogg",
      );
      const correctSound = new Audio(
        "https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg",
      );

      flipSound.volume = 0.2;
      correctSound.volume = 0.07;

      function toggleSound() {
        soundOn = !soundOn;
        localStorage.setItem("soundOn", JSON.stringify(soundOn));
        updateSoundIcon();
      }

      function updateSoundIcon() {
        const el = document.getElementById("soundIcon");
        if (el) el.textContent = soundOn ? "ðŸ”Š" : "ðŸ”‡";
      }

      /* ===== DATA ===== */


let data = JSON.parse(localStorage.getItem(FLASH_KEY)) || {
  topics: {},
};
let stats = JSON.parse(localStorage.getItem(STATS_KEY)) || {
  sessions: 0,
  history: [],
  perTopic: {},
  hardWords: {},
};


      const topicSelect = document.getElementById("topicSelect");
      const bankTopicSelect = document.getElementById("bankTopicSelect");
      const bankListTopicSelect = document.getElementById(
        "bankListTopicSelect",
      );
      const searchInput = document.getElementById("searchInput");
      const sortSelect = document.getElementById("sortSelect");
      const wordList = document.getElementById("wordList");
      const addTopicSelect = document.getElementById("addTopicSelect");
      const learnInput = document.getElementById("learnInput");
      const translationInput = document.getElementById("translationInput");
      const newTopicInput = document.getElementById("newTopicInput");
      const importFile = document.getElementById("importFile");
      const shuffleBtn = document.getElementById("shuffleBtn");
      const card = document.getElementById("card");

/* ===== HUB INDEX ===== */

// guard â€“ ×‘×“×™×§×” ×©×”×¡×¤×¨×™×™×” × ×˜×¢× ×”


function ensureHubLoaded() {
  if (!window.HUB_INDEX) {
    alert("Word Library is not available right now.");
    return false;
  }
  return true;
}

// state
let hubIndex = null;
let currentTopic = null;
let lastAddTopic = null;



      /* ===== UTIL ===== */

      function save() {
        localStorage.setItem(FLASH_KEY, JSON.stringify(data));
localStorage.setItem(STATS_KEY, JSON.stringify(stats));

      }

      /* ===== TOPIC NAME GATE ===== */

      function normalizeTopicName(name) {
        return name
          .trim()
          .replace(/\s+/g, " ") // ×¨×•×•×—×™× ×›×¤×•×œ×™× â†’ ×¨×•×•×— ××—×“
          .toLowerCase(); // ×‘×œ×™ ×”×‘×“×œ ××•×ª×™×•×ª
      }

      /*
mode:
- "create"  â†’ ×™×¦×™×¨×ª ×˜×•×¤×™×§ ×—×“×© (ADD / IMPORT / DOWNLOAD)
- "rename"  â†’ ×©×™× ×•×™ ×©× ×˜×•×¤×™×§
*/
      function validateTopicName(name, mode, currentName = null) {
        const n = normalizeTopicName(name);

        if (!n) {
          alert("Topic name is empty");
          return null;
        }

        // ×™×¦×™×¨×ª ×˜×•×¤×™×§ ×—×“×©
        if (mode === "create") {
          if (data.topics[n]) {
            alert(`Topic "${n}" already exists`);
            return null;
          }
          return n;
        }

        // ×©×™× ×•×™ ×©×
        if (mode === "rename") {
          if (n === currentName) return n; // ××•×ª×• ×©× â€“ ×ž×•×ª×¨
          if (data.topics[n]) {
            alert(`Topic "${n}" already exists`);
            return null;
          }
          return n;
        }

        console.error("Unknown topic name validation mode:", mode);
        return null;
      }

      function allWords() {
        let a = [];
        Object.keys(data.topics).forEach((t) => {
          if (t !== "All words") a.push(...data.topics[t]);
        });
        return a;
      }

      /* ===== LIBRARY â†’ FC TOPIC ===== */
      function saveCSVAsTopic(csvText, topicName) {
        // ðŸ”’ ×—×¡×™×ž×” ×ž×™×™×“×™×ª â€“ ×©× ×˜×•×¤×™×§ ×›×‘×¨ ×§×™×™×
        const checked = validateTopicName(topicName, "create");
        if (!checked) {
          alert("This file was already loaded");
          return false;
        }

        const rows = csvText.split(/\r?\n/);
const words = [];

rows.forEach((line) => {
  if (!line.trim()) return;

  const p = line.split(",");
  if (p.length >= 2) {
    words.push({
      id: Date.now() + Math.random(),
      learn: p[0].replace(/"/g, "").trim(),
      tr: p.slice(1).join(",").replace(/"/g, "").trim(),
    });
  }
});

        if (words.length === 0) {
          alert("File contains no valid words");
          return false;
        }

        if (data.topics[topicName]) {
          alert("Topic already exists. File not loaded.");
          return false;
        }

        data.topics[topicName] = words;

        save();
        loadTopics();

        return true;
      }

      /* ===== NAV ===== */
      function show(id) {
        document
          .querySelectorAll(".screen")
          .forEach((s) => s.classList.remove("active"));
        document.getElementById(id).classList.add("active");
      }

      function showBank() {
  loadTopics();
  show("bank");

  requestAnimationFrame(() => {
    const screen = document.getElementById("bank");
    if (screen) screen.scrollTop = 0;
  });
}


      function showStats() {
        renderStats();
        show("stats");
      }
      function showContact() {
        show("contact");
      }

      function showDownload() {

if (stats.current) {
  exitSessionSafe("download");
  return;
}

  if (!ensureHubLoaded()) return;

        // ××™×¤×•×¡ ×©×¤×”
        currentDownloadLang = null;

        // ××™×¤×•×¡ ×‘×—×™×¨×” ×•×¡×˜×™×™×œ ×©×œ ×”×©×¤×”
        if (downloadLangSelect) {
          downloadLangSelect.value = "";
        }

        // ×‘× ×™×™×ª UI ×©×œ ×”××§×•×¨×“×™×•× ×™×
        buildDownloadUI();

        // ×ž×¦×‘ ××¤×•×¨ â€“ × ×•×©××™× × ×¢×•×œ×™× ×¢×“ ×‘×—×™×¨×ª ×©×¤×”
        const acc = document.getElementById("downloadAccordions");
        if (acc) {
          acc.classList.add("lang-not-selected");
        }

        // ×¢×“×›×•×Ÿ ×¡×˜×™×™×œ ×©×œ select (×ž×•×¨×™×“ ×›×œ ×¡×™×ž×•×Ÿ ×§×•×“×)
        markActiveDownloadLang();

        // ×¡×’×™×¨×ª ×›×œ ×”××§×•×¨×“×™×•× ×™×
        closeAllAccordions();

        // ×”×¦×’×ª ×”×ž×¡×š
        show("download");
      }

function goHome() {
  resetBankSearch();
  exitSessionSafe("home");
  loadTopics();
  updateInstructions();
}


      /* ===== HOME LOGIC ===== */
      function updateInstructions() {
        document
          .getElementById("instructions")
          .classList.toggle("hidden", allWords().length > 0);
      }

      /* ===== TOPICS ===== */

      function loadTopics() {
  const hardLabel = "Hard Words";

  const baseTopics = Object.keys(data.topics).filter(
    (t) => t !== "All words",
  );

  const isBankEmpty = baseTopics.length === 0;

  /* ---------- HOME ---------- */
  topicSelect.innerHTML = '<option value="">Select topic</option>';
  topicSelect.innerHTML += `<option>${hardLabel}</option>`;
  baseTopics.forEach((t) => {
    topicSelect.innerHTML += `<option>${t}</option>`;
  });

  /* ---------- BANK ---------- */
  bankTopicSelect.innerHTML = '<option value="">Select topic</option>';
  bankTopicSelect.innerHTML += `<option>${hardLabel}</option>`;
  baseTopics.forEach((t) => {
    bankTopicSelect.innerHTML += `<option>${t}</option>`;
  });

  /* ---------- BANK LIST ---------- */
  bankListTopicSelect.innerHTML = "";
  baseTopics.forEach((t) => {
    bankListTopicSelect.innerHTML += `<option>${t}</option>`;
  });

  if (currentTopic && baseTopics.includes(currentTopic)) {
    bankListTopicSelect.value = currentTopic;
  }

  /* ---------- EMPTY BANK GUARD ---------- */
  if (isBankEmpty) {
    topicSelect.disabled = true;
    bankTopicSelect.disabled = true;
    bankListTopicSelect.innerHTML = "";
  } else {
    topicSelect.disabled = false;
    bankTopicSelect.disabled = false;
  }
}


      /* ===== BANK ===== */


function resetBankSearch() {
  searchInput.value = "";
}



      function switchBankListTopic() {
  const t = bankListTopicSelect.value;
  if (!t) return;

  if (t === "Hard Words") {
    alert("Hard Words cannot be edited in Bank.");
    return;
  }

  currentTopic = t;
  deleteTopicBtn.classList.toggle("hidden", currentTopic === "All words");
  renderWordList();
}


      function renameCurrentTopic() {
        if (currentTopic === "Hard Words") {
  alert("Hard Words cannot be renamed.");
  return;
}

        if (!currentTopic || currentTopic === "All words") return;

        const oldKey = normalizeTopicName(currentTopic);
        const input = prompt("New topic name:", currentTopic);
        if (!input) return;

        const newKey = normalizeTopicName(input);

        // ××•×ª×• ×ž×¤×ª×— ×‘×¤×•×¢×œ
        if (newKey === oldKey) return;

        // ×§×™×™× ×›×‘×¨
        if (data.topics[newKey]) {
          alert("Topic name already exists. Rename cancelled.");
          return;
        }

        // ×”×¢×‘×¨×”
        data.topics[newKey] = data.topics[oldKey];
        delete data.topics[oldKey];

        // ×¢×“×›×•×Ÿ state
        currentTopic = newKey;
        lastAddTopic = newKey;

        // ×¡×˜×˜×™×¡×˜×™×§×”
        if (stats.perTopic[oldKey]) {
          stats.perTopic[newKey] = stats.perTopic[oldKey];
          delete stats.perTopic[oldKey];
        }
        if (stats.current && stats.current.topic === oldKey) {
          stats.current.topic = newKey;
        }

        save();
        loadTopics();
        renderWordList();
      }

      function addWordToCurrentTopic() {
        if (!currentTopic) return;

        lastAddTopic = currentTopic;
        showAdd();
      }

      bankTopicSelect.onchange = () => {
        if (!bankTopicSelect.value) return;
        currentTopic = bankTopicSelect.value;
        deleteTopicBtn.classList.toggle("hidden", currentTopic === "All words");
      
        show("bankList");

requestAnimationFrame(() => {
  const screen = document.getElementById("bankList");
  if (screen) screen.scrollTop = 0;
});

  renderWordList();
document.getElementById("bankList").scrollTop = 0;

      };

      function renderWordList() {
  if (currentTopic === "Hard Words") {
    wordList.innerHTML =
      "<p>Hard Words are managed via Statistics.</p>";
    return;
  }

  let q = searchInput.value.toLowerCase();
  let sort = sortSelect.value;
  wordList.innerHTML = "";

  let arr = [...data.topics[currentTopic]];

  if (q) {
    arr = arr.filter(
      (w) =>
        w.learn.toLowerCase().includes(q) ||
        w.tr.toLowerCase().includes(q)
    );
  }

  if (sort === "learn") {
    arr.sort((a, b) => a.learn.localeCompare(b.learn));
  }
  if (sort === "tr") {
    arr.sort((a, b) => a.tr.localeCompare(b.tr));
  }

  arr.forEach((w, i) => {
    wordList.innerHTML += `
      <div class="list-item">
        <div class="word-line">
          ${i + 1}. ${w.learn} â€“ ${w.tr}
        </div>
        <div class="actions">
          <button style="font-size:12px;padding:6px;" onclick="editWord(${w.id})">Edit</button>
          <button style="font-size:12px;padding:6px;" onclick="deleteWord(${w.id})">Delete</button>
        </div>
      </div>`;
  });
}


      function exportCurrentTopic() {
        let rows = ["Learning language,Translation"];
        data.topics[currentTopic].forEach((w) =>
          rows.push(`"${w.learn}","${w.tr}"`),
        );
        let blob = new Blob([rows.join("\n")], { type: "text/csv" });
        let a = document.createElement("a");
        a.href = URL.createObjectURL(blob);
        a.download = `${currentTopic}.csv`;
        a.click();
      }

      function deleteCurrentTopic() {
        if (confirm("Delete this topic and all its words?")) {
          delete data.topics[currentTopic];
          save();
          showBank();
        }
      }

      function deleteWord(id) {
        data.topics[currentTopic] = data.topics[currentTopic].filter(
          (w) => w.id !== id,
        );
        save();
        renderWordList();
      }

      function editWord(id) {
        returnToBankListAfterSave = true;
        const w = data.topics[currentTopic].find((x) => x.id === id);
        deleteWord(id);
        showAdd();
        addTopicSelect.value = currentTopic;
        onAddTopicChange();
        learnInput.value = w.learn;
        translationInput.value = w.tr;
      }
      /* ===== ADD WORD ===== */

      function showAdd() {
  resetBankSearch();

  learnInput.value = "";
  translationInput.value = "";
  newTopicInput.value = "";
  newTopicInput.disabled = true;
  newTopicInput.classList.add("hidden");

  loadAddTopics();
  show("add");
}


      function loadAddTopics() {
        addTopicSelect.innerHTML = "";

        addTopicSelect.innerHTML += `<option value="">Select topic</option>`;
        addTopicSelect.innerHTML += `<option value="_new">+ New topic</option>`;

        Object.keys(data.topics).forEach((t) => {
          if (t !== "All words") {
            addTopicSelect.innerHTML += `<option value="${t}">${t}</option>`;
          }
        });

        if (lastAddTopic && data.topics[lastAddTopic]) {
          addTopicSelect.value = lastAddTopic;
        } else {
          addTopicSelect.value = "";
        }

        onAddTopicChange();
      }

      function onAddTopicChange() {
        const isNew = addTopicSelect.value === "_new";

        newTopicInput.disabled = !isNew;
        newTopicInput.classList.toggle("hidden", !isNew);

        if (!isNew) {
          newTopicInput.value = "";
        }
      }

      function saveWord() {
  const isNew = addTopicSelect.value === "_new";
  const topicName = isNew
    ? newTopicInput.value.trim()
    : addTopicSelect.value;

  if (!topicName) {
    alert("Enter topic name");
    return;
  }

  if (!learnInput.value || !translationInput.value) return;

  if (isNew) {
    const checked = validateTopicName(topicName, "create");
    if (!checked) return;
  }

  if (!data.topics[topicName]) {
    data.topics[topicName] = [];
  }

  data.topics[topicName].push({
    id: Date.now() + Math.random(),
    learn: learnInput.value,
    tr: translationInput.value,
  });

  currentTopic = topicName;
  lastAddTopic = topicName;

  save();
  loadTopics();
  updateInstructions();

  learnInput.value = "";
  translationInput.value = "";
  newTopicInput.value = "";

  show("bankList");
requestAnimationFrame(() => {
  const screen = document.getElementById("bankList");
  if (screen) screen.scrollTop = 0;
});

  renderWordList();

document.getElementById("bankList").scrollTop = 0;


}


      /* ===== IMPORT ===== */

      function triggerImport() {
        importFile.click();
      }

      importFile.onchange = (e) => {
        const file = e.target.files[0];
        if (!file) {
          importFile.value = "";
          return;
        }

        // ðŸ”¥ ×©× ×”× ×•×©× = ×©× ×”×§×•×‘×¥ ×‘×œ×™ ×¡×™×•×ž×ª
        const topic = file.name.replace(/\.[^/.]+$/, "");

        // ×™×¦×™×¨×ª × ×•×©× ×—×“×© (××• × ×™×§×•×™ ×§×™×™×) ×—×¡×™×ž×ª ×©× ×›×¤×•×œ
        const checked = validateTopicName(topic, "create");
        if (!checked) {
          importFile.value = "";
          return;
        }

        if (data.topics[topic]) {
          alert("Topic already exists. Import cancelled.");
          importFile.value = "";
          return;
        }

        data.topics[topic] = [];

        const reader = new FileReader();
        reader.onload = (ev) => {
          ev.target.result.split(/\r?\n/).forEach((line, i) => {
            if (i === 0) return;

            const p = line.split(",");
            if (p.length >= 2) {
              data.topics[topic].push({
                id: Date.now() + Math.random(),
                learn: p[0].replace(/"/g, ""),
                tr: p.slice(1).join(",").replace(/"/g, ""),
              });
            }
          });

          // ðŸ”¥ ×©×ž×™×¨×” ×•×¢×“×›×•×Ÿ
          save();
          loadTopics();
          updateInstructions();

          // ðŸ”¥ ×‘×—×™×¨×ª ×”× ×•×©× ×•×¤×ª×™×—×ª ×¡×©×Ÿ ××•×˜×•×ž×˜×™×ª
          currentTopic = topic;
          topicSelect.value = topic;

          importFile.value = "";

          startSessionSafe(topic);    // ðŸ”¥ ×¤×•×ª×— ×¡×©×Ÿ ×ž×™×™×“
        };

        reader.readAsText(file, "UTF-8");
      };

      /* ===== SESSION ===== */


function exitSessionSafe(nextScreen) {
  if (stats.current) {
    finishSessionIfActive();
  }

  if (nextScreen) {
    show(nextScreen);
  } else {
    show("home");
  }
}




function startSessionSafe(topicName) {
  // ×¡×’×™×¨×ª ×¡×©×Ÿ ×§×•×“× ×× ×§×™×™×
  if (stats.current) {
    finishSessionIfActive();
  }

  // ×‘×—×™×¨×ª × ×•×©× ×‘×¦×•×¨×” ×ž×‘×•×§×¨×ª
  currentTopic = topicName;
  topicSelect.value = topicName;

  // reset flags
  cardFlipped = false;
  shuffleUsed = false;

  startSession();
}

      function startSession() {
        currentTopic = topicSelect.value;
        if (!currentTopic) return;

        if (currentTopic === "Hard Words") {
          session = Object.entries(stats.hardWords)
            .filter((e) => e[1] >= 2)
            .map((e) => {
              let [learn, tr] = e[0].split("||");
              return { learn, tr };
            });
        } else {
          session = [...data.topics[currentTopic]];

          // ðŸ”¥ ×”×—×œ×ª ×ž×™×•×Ÿ ×”×¨×©×™×ž×” ×’× ×¢×œ ×”×¡×©×Ÿ
          const sort = sortSelect.value;
          if (sort === "learn") {
            session.sort((a, b) => a.learn.localeCompare(b.learn));
          }
          if (sort === "tr") {
            session.sort((a, b) => a.tr.localeCompare(b.tr));
          }
        }

        if (session.length === 0) {
          stats.current = null;
          showBank();
          return;
        }

        sessionDefaultDirection = "A";
        cardFlipped = false;
        shuffleUsed = false;
        shuffleBtn.classList.remove("hidden");

        stats.sessions++;
        stats.current = { topic: currentTopic, correct: 0, wrong: 0 };
        nextCard();
      }

      function nextCard() {
        if (session.length === 0) {
          stats.history.push(stats.current);
          stats.history = stats.history.slice(-10);

          let t = stats.current.topic;
          if (!stats.perTopic[t]) stats.perTopic[t] = { correct: 0, wrong: 0 };
          stats.perTopic[t].correct += stats.current.correct;
          stats.perTopic[t].wrong += stats.current.wrong;

          save();
          show("sessionEnd");
          return;
        }
        current = session[0];
        cardFlipped = false;
        renderCard();
        show("session");
      }

      function renderCard() {
        let side = cardFlipped
          ? sessionDefaultDirection === "A"
            ? "B"
            : "A"
          : sessionDefaultDirection;

        const text = side === "A" ? current.learn : current.tr;
        card.textContent = text;

        requestAnimationFrame(() => {
          autoFitCardText();
        });

        document.getElementById("remainingCount").textContent = session.length;
      }

      function autoFitCardText() {
        const maxFont = 102; // ×¤×™ 3
        const minFont = 18;

        let size = maxFont;
        card.style.fontSize = size + "px";

        while (size > minFont) {
          card.style.fontSize = size + "px";

          // ×× ×™×© ×’×œ×™×©×” â€“ ×ž×§×˜×™× ×™×
          if (
            card.scrollHeight > card.clientHeight ||
            card.scrollWidth > card.clientWidth
          ) {
            size -= 2;
          } else {
            break;
          }
        }
      }

      function flipCard() {
        cardFlipped = !cardFlipped;
        if (soundOn) {
          flipSound.currentTime = 0;
          flipSound.play();
        }
        renderCard();
      }

      function flipDirection() {
        sessionDefaultDirection = sessionDefaultDirection === "A" ? "B" : "A";
        cardFlipped = false;
        renderCard();
      }

      function shuffleSession() {
        if (shuffleUsed) return;

        shuffleUsed = true;
        shuffleBtn.classList.add("hidden");

        session.sort(() => Math.random() - 0.5);

        current = session[0];
        cardFlipped = false;
        renderCard();
      }

      function markKnown() {
        if (soundOn) {
          correctSound.currentTime = 0;
          correctSound.play();
        }
        stats.current.correct++;
        session.shift();
        nextCard();
      }

      function markUnknown() {
        stats.current.wrong++;
        let key = current.learn + "||" + current.tr;
        stats.hardWords[key] = (stats.hardWords[key] || 0) + 1;
        session.push(session.shift());
        nextCard();
      }

      function finishSessionIfActive() {
        if (!stats.current) return;

        stats.history.push(stats.current);

        stats.history = stats.history.slice(-10);

        const t = stats.current.topic;
        if (!stats.perTopic[t]) {
          stats.perTopic[t] = { correct: 0, wrong: 0 };
        }

        stats.perTopic[t].correct += stats.current.correct;
        stats.perTopic[t].wrong += stats.current.wrong;

        stats.current = null;
        save();
      }

      function loadCSVToSession(csvText, topicTitle) {
        session = [];

        csvText.split(/\r?\n/).forEach((line, i) => {
          if (i === 0) return;
          const p = line.split(",");
          if (p.length >= 2) {
            session.push({
              learn: p[0].replace(/"/g, ""),
              tr: p.slice(1).join(",").replace(/"/g, ""),
            });
          }
        });

        if (session.length === 0) return;

        currentTopic = topicTitle;
        sessionDefaultDirection = "A";
        cardFlipped = false;
        shuffleUsed = false;

        stats.sessions++;
        stats.current = { topic: currentTopic, correct: 0, wrong: 0 };

        nextCard();
      }

      /* ===== STATS ===== */
      function renderStats() {
        let topics = Object.keys(data.topics).length - 1;
        let words = allWords().length;

        let topicStats = "";
        Object.keys(stats.perTopic).forEach((t) => {
          let c = stats.perTopic[t].correct;
          let w = stats.perTopic[t].wrong;
          let acc = c + w > 0 ? Math.round((c / (c + w)) * 100) : 0;
          topicStats += `
      <div class="stat-block">
        <strong>Topic: ${t}</strong><br>
        Correct: ${c}<br>
        Wrong: ${w}<br>
        Accuracy: ${acc}%
      </div>`;
        });

        let hardEntries = Object.entries(stats.hardWords)
          .filter((e) => e[1] >= 2)
          .sort((a, b) => b[1] - a[1]);

        let hardTable = hardEntries.length
          ? `
    <button onclick="goHome()" class="back">Back</button>

    <table class="hard-table">
      <thead>
        <tr>
          <th>Hard Words</th>
          <th>Times Wrong</th>
        </tr>
      </thead>
      <tbody>
        ${hardEntries
          .map((e) => {
            let [learn, tr] = e[0].split("||");
            return `
            <tr>
              <td class="hard-word">${learn} â€“ ${tr}</td>
              <td class="hard-count">${e[1]}</td>
            </tr>`;
          })
          .join("")}
      </tbody>
    </table>
  `
          : "<p>No hard words yet</p>";

        statsContent.innerHTML = `
    <p>Topics: ${topics}</p>
    <p>Words: ${words}</p>
    <p>Sessions started: ${stats.sessions}</p>
    <hr>
    <h3>By topic</h3>
    ${topicStats || "<p>No data</p>"}
    <hr>
    <h3>Hard Words</h3>
    ${hardTable}
  `;
      }

      function resetStats() {
        if (!confirm("Reset ALL statistics?")) return;

        stats = {
          sessions: 0,
          history: [],
          perTopic: {},
          hardWords: {},
        };

        localStorage.setItem(STATS_KEY, JSON.stringify(stats));

        renderStats();
      }

      /* ===== MISC ===== */


      /* == reset == */
async function hardReset() {
  localStorage.clear();

  if ("caches" in window) {
    const keys = await caches.keys();
    await Promise.all(keys.map(k => caches.delete(k)));
  }

  if ("serviceWorker" in navigator) {
    const regs = await navigator.serviceWorker.getRegistrations();
    await Promise.all(regs.map(r => r.unregister()));
  }

  localStorage.setItem(RESET_FLAG, "1");
  location.reload();
}


      function toggleAccordion(header) {
        const acc = header.parentElement;
        const container = acc.parentElement; // #downloadAccordions ××• #bank (×× ×‘×¢×ª×™×“)

        // ×¡×’×™×¨×ª ×›×œ ×”××§×•×¨×“×™×•× ×™× ×‘××•×ª×• ×ž×¡×š
        container.querySelectorAll(".accordion.open").forEach((a) => {
          if (a !== acc) a.classList.remove("open");
        });

        // toggle ×¨×§ ×©×œ ×”× ×•×›×—×™
        acc.classList.toggle("open");
      }

      const restartBtn = document.getElementById("restartSessionBtn");
if (restartBtn) {
  restartBtn.onclick = () => {
    shuffleUsed = false;
    startSession();
  };
}

const backBtn = document.getElementById("backHomeBtn");
if (backBtn) {
  backBtn.onclick = () => {
    goHome();
  };
}


      /* ===== DOWNLOAD ===== */

      async function buildDownloadUI() {
        if (!hubIndex || !currentDownloadLang) return;

        const container = document.getElementById("downloadAccordions");
        container.innerHTML = "";

        const { groups, topics } = hubIndex;

        for (const group of groups) {
          const acc = document.createElement("div");
          acc.className = "accordion";

          acc.innerHTML = `
      <div class="accordion-header" onclick="toggleAccordion(this)">
        ${group.title} <span>â–¶</span>
      </div>
      <div class="accordion-content">
        <ul></ul>
      </div>
    `;

          const ul = acc.querySelector("ul");
          let hasAnyFiles = false;

          topics
            .filter((t) => t.group === group.id)
            .forEach((topic) => {
              const files = topic.files?.[currentDownloadLang];

              const li = document.createElement("li");
              li.textContent = topic.title;

              if (files && files.length) {
                hasAnyFiles = true;
                li.classList.add("li-available");

                
li.onclick = () => {
  const fileName = files[0];
  const path =
    `hub/${currentDownloadLang}/${topic.id}/${fileName}`;

  onDownloadFile(path, topic.title, fileName);
};

              } else {
                li.classList.add("li-locked");
              }

              ul.appendChild(li);
            });

          // ðŸ”¥ ×¦×‘×¢ ×›×•×ª×¨×ª ×¨×§ ×× ×™×© ×§×‘×¦×™× ×‘×§×‘×•×¦×”
          if (hasAnyFiles) {
            acc.classList.add("accordion-has-files");
          }

          container.appendChild(acc);
        }
      }

      async function onDownloadFile(path, topicTitle, fileName) {
        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), 15000);

        try {
          const res = await fetch(path, { signal: controller.signal });
          if (!res.ok) {
            alert("File not found");
            return;
          }

          const text = await res.text();

          const appTopicName = `${topicTitle} â€“ ${fileName.replace(/\.csv$/i, "")}`;

          const ok = saveCSVAsTopic(text, appTopicName);
          if (!ok) return;

          currentTopic = appTopicName;
          topicSelect.value = appTopicName;

          startSessionSafe(appTopicName);
        } catch (e) {
          alert("Download timeout. Try again.");
        } finally {
          clearTimeout(timeoutId);
        }
      }

      /* ===== DOWNLOAD LANGUAGE SELECTION ===== */

      let currentDownloadLang = null;
      const downloadLangSelect = document.getElementById("downloadLangSelect");

      if (downloadLangSelect) {
        downloadLangSelect.addEventListener("change", () => {
          currentDownloadLang = downloadLangSelect.value || null;
          markActiveDownloadLang();
          buildDownloadUI(); // ðŸ”¥ ×—×•×‘×”
          closeAllAccordions(); // × ×™×§×•×™ ×ž×¦×‘ ×§×•×“×
        });
      }

      function markActiveDownloadLang() {
        downloadLangSelect.classList.remove(
          "lang-he-en",
          "lang-pl-en",
          "lang-ar-he",
          "lang-es-he",
        );

        const acc = document.getElementById("downloadAccordions");

        if (currentDownloadLang) {
          downloadLangSelect.classList.add("lang-" + currentDownloadLang);
          if (acc) acc.classList.remove("lang-not-selected");
        } else {
          if (acc) acc.classList.add("lang-not-selected");
        }
      }

      function closeAllAccordions() {
        document
          .querySelectorAll("#download .accordion.open")
          .forEach((acc) => acc.classList.remove("open"));
      }

      function exitApp() {
        // PWA / Mobile
        if (navigator.userAgent.includes("Android")) {
          navigator.app?.exitApp?.();
        }

        // ×“×¤×“×¤×Ÿ ×¨×’×™×œ â€“ ×—×–×¨×” ××—×•×¨×”
        window.history.back();
      }



       function gateUntilReset() {
  if (localStorage.getItem(RESET_FLAG)) return;

  document
    .querySelectorAll(".screen")
    .forEach(s => s.classList.remove("active"));

  document.getElementById("resetGate").classList.add("active");
}




      /* ===== INIT ===== */
      (() => {

gateUntilReset();


        hubIndex = window.HUB_INDEX || null;

        loadTopics();
        updateInstructions();
      })();




    </script>
                           <div> T E S T - 24 </div>
  </body>
</html>