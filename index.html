<!DOCTYPE html>
<html lang="en">
<head>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#111111">

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hebrew with MotiVation</title>

<style>

.hidden{
  display:none;
}

body{
  margin:0;
  font-family:system-ui, sans-serif;
  background:#111;
  color:#fff;
}

/* ---------- SCREENS ---------- */
.screen{
  display:none;
  padding:18px;
  max-width:420px;
  margin:auto;
  min-height:100vh;
  box-sizing:border-box;
}
.screen.active{display:block}

/* ---------- HOME ---------- */
.welcome{
  font-size:30px;
  font-weight:800;
  text-align:center;
  margin-top:18px;
}
.instructions{
  text-align:center;
  font-size:16px;
  margin:16px 0 26px;
  color:#ddd;
}
.title-bottom{
  text-align:center;
  font-size:20px;
  margin-top:28px;
  opacity:0.85;
}

/* ---------- BUTTONS ---------- */
button{
  width:100%;
  padding:14px;
  margin:8px 0;
  font-size:16px;
  font-weight:600;
  border:none;
  border-radius:14px;
  cursor:pointer;
  background:linear-gradient(180deg,#f1f4f8,#dfe7f1);
  color:#222;
  box-shadow:0 4px 8px rgba(0,0,0,0.25);
  transition:transform .1s, box-shadow .1s, background .2s;
}
button:hover{
  background:linear-gradient(180deg,#ffffff,#e6eef8);
}
button:active{
  transform:translateY(2px);
  box-shadow:0 2px 4px rgba(0,0,0,0.35);
}
.good{
  background:linear-gradient(180deg,#b7e4c7,#95d5b2);
}
.bad{
  background:linear-gradient(180deg,#f7b2ad,#ee938c);
}
.back{
  background:linear-gradient(180deg,#e0e0e0,#cfcfcf);
}
.delete{
  background:linear-gradient(180deg,#ff9aa2,#ff6f6f);
  color:#300;
}

/* ---------- FORM ---------- */
select,input,textarea{
  width:100%;
  padding:12px;
  margin:8px 0;
  font-size:16px;
  border-radius:10px;
  border:none;
  box-sizing:border-box;
}

/* ---------- SESSION â€“ COSMETIC ONLY ---------- */

.flip-hint{
  text-align:center;
  font-family:"Comic Sans MS","Trebuchet MS",cursive;
  font-size:18px;
  margin-bottom:8px;
  color:#ffd966;
}

.card-frame{
  border:5px solid #6fa8dc;
  border-radius:18px;
  padding:14px;
  background:#2a2a2a;
  box-shadow:
    0 10px 18px rgba(0,0,0,0.6),
    inset 0 0 0 2px rgba(255,255,255,0.08);
}

.card{
  background:#111;
  height:220px;            /* ×›×¨×˜×™×¡ ×§×‘×•×¢ */
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:102px;         /* ×¤×™ 3 */
  line-height:1.15;
  text-align:center;
  border-radius:12px;
  padding:20px;
  user-select:none;

  overflow:hidden;         /* ×”×›×¨×˜×™×¡ ×œ× ×’×“×œ */
  white-space:normal;      /* ××•×ª×¨ ×œ×©×‘×•×¨ ×©×•×¨×” */
  word-break:normal;       /* âŒ ×œ× ×©×•×‘×¨×™× ××™×œ×” */
  overflow-wrap:normal;    /* âŒ ×œ× ×©×•×‘×¨×™× ××™×œ×” */
}



.remaining{
  text-align:center;
  font-size:20px;
  margin-top:10px;
  color:#cfe2f3;
}

.row{
  display:flex;
  gap:10px;
  margin-top:14px;
}
.row button{width:50%}

/* ---------- LIST ---------- */


#bankListTopicSelect{
  width:100%;
  padding:12px;
  margin-bottom:10px;
  font-size:16px;
  border-radius:10px;
  border:none;
  box-sizing:border-box;

  position:relative;
  z-index:10;              /* ğŸ”¥ ×§×¨×™×˜×™ */
}

.list-item{
  background:#222;
  padding:10px;
  margin:8px 0;
  border-radius:10px;
}

.actions{
  display:flex;
  gap:8px;
}

.actions button{width:50%}


/* ---------- CONTACT ---------- */
.contact button{
  background:linear-gradient(180deg,#e6e6e6,#cfcfcf);
  color:#222;
  font-weight:700;
}
.stat-block{
  background:#1c1c1c;
  padding:10px;
  margin:8px 0;
  border-radius:10px;
}

/* --- HARD WORDS TABLE --- */
.hard-table{
  width:100%;
  border-collapse:collapse;
  margin-top:10px;
}
.hard-table th{
  text-align:left;
  padding:8px;
  border-bottom:2px solid #555;
  font-size:16px;
}
.hard-table td{
  padding:10px 8px;
  border-bottom:1px solid #333;
  vertical-align:top;
}
.hard-word{
  font-size:20px;
  font-weight:600;
}
.hard-count{
  text-align:center;
  font-size:18px;
}

.sound-toggle{
  text-align:center;
  font-size:22px;
  margin:10px 0 6px;
  cursor:pointer;
  user-select:none;
  opacity:0.85;
}
.sound-toggle:hover{
  opacity:1;
}

</style>
</head>

<body>

<!-- HOME -->
<div class="screen active" id="home">
  <div class="welcome">WELCOME</div>

  <div id="instructions" class="instructions">
    To start, add words OR load a file in the Word Bank
  </div>

  <select id="topicSelect"></select>
  <button onclick="startSession()">Start</button>
  <button onclick="showBank()">Word Bank</button>
  <button onclick="showStats()">Statistics</button>
  <button onclick="showContact()">Contact</button>
  <button onclick="exitApp()" class="back">Exit</button>

  <div class="title-bottom">Hebrew with MotiVation</div>
</div>

<!-- BANK -->
<div class="screen" id="bank">
  <h2>Word Bank</h2>
  <select id="bankTopicSelect"></select>
  <button onclick="showAdd()">Add words / topic</button>
  <button onclick="triggerImport()">Import word file</button>
  <button onclick="showHome()" class="back">Back</button>
</div>

<!-- BANK LIST -->

<div class="screen" id="bankList">
<select id="bankListTopicSelect" onchange="switchBankListTopic()"></select>


<button onclick="addWordToCurrentTopic()" class="good">
  + Add word
</button>

<button onclick="exportCurrentTopic()">Export word file</button>

<div style="display:flex; gap:8px;">
  <button onclick="renameCurrentTopic()" style="
    flex:1;
    background:linear-gradient(180deg,#9fc5ff,#6fa8ff);
    color:#002b5c;
  ">
    Rename
  </button>

  <button id="deleteTopicBtn" class="delete hidden" style="flex:1;"
    onclick="deleteCurrentTopic()">
    Delete
  </button>
</div>

<button onclick="showHome()" style="
  background:linear-gradient(180deg,#ffe599,#f1c232);
  color:#5c3b00;
  font-weight:700;
">
  Back to Home
</button>


  <input id="searchInput" placeholder="Search..." oninput="renderWordList()">
  <select id="sortSelect" onchange="renderWordList()">
    <option value="">No sorting</option>
    <option value="learn">By learning language</option>
    <option value="tr">By translation</option>
  </select>

  <div id="wordList"></div>

  <button onclick="showBank()" class="back">Back</button>
</div>

<!-- ADD -->
<div class="screen" id="add">
  <h2>Add word</h2>
  <select id="addTopicSelect" onchange="onAddTopicChange()"></select>
  <input id="newTopicInput" class="hidden" placeholder="New topic name">
  <textarea id="learnInput" placeholder="Learning language"></textarea>
  <textarea id="translationInput" placeholder="Translation"></textarea>
  <button onclick="saveWord()">Save</button>
  <button onclick="goHome()" class="back">Back</button>

</div>

<!-- SESSION -->
<div class="screen" id="session">

  <div class="flip-hint">Click to flip</div>

  <div class="card-frame">
    <div class="card" id="card" onclick="flipCard()"></div>
  </div>

  <div class="remaining">
    Remaining: <span id="remainingCount"></span>
  </div>

  <div class="sound-toggle" onclick="toggleSound()" id="soundIcon">ğŸ”Š</div>


  <div class="row">
    <button class="good" onclick="markKnown()">I knew it</button>
    <button class="bad" onclick="markUnknown()">Ooooopsi</button>
  </div>

  <button id="shuffleBtn" onclick="shuffleSession()">Shuffle</button>
  <button onclick="flipDirection()">Flip direction</button>
  <button onclick="goHome()" class="back">Exit</button>


</div>

<!-- STATS -->

<div class="screen" id="stats">
  <h2>Statistics</h2>

  <button onclick="resetStats()" class="delete">Reset statistics</button>

  <div id="statsContent"></div>

  <button onclick="showHome()" class="back">Back</button>

</div>


<!-- CONTACT -->
<div class="screen contact" id="contact">
  <h2>Contact</h2>
  <button onclick="openLink('mailto:mottex@gmail.com')">Email: mottex@gmail.com</button>
  <button onclick="openLink('https://wa.me/48604726360')">WhatsApp: +48 604 726 360</button>
  <button onclick="openLink('https://www.facebook.com/share/1D6uJLL5nK/')">Facebook</button>
  <button onclick="openLink('https://www.instagram.com/hebrew_with_motivation')">Instagram</button>
  <button onclick="showHome()" class="back">Back</button>
</div>

<input type="file" id="importFile" accept=".csv" class="hidden">

<script>

/* ===== SOUND ===== */

let soundOn = JSON.parse(localStorage.getItem("soundOn") ?? "true");
// very soft sounds

const flipSound = new Audio("https://actions.google.com/sounds/v1/impacts/metal_parts_cling.ogg");
const correctSound = new Audio("https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg");

flipSound.volume = 0.2;
correctSound.volume = 0.07;


function toggleSound(){
  soundOn = !soundOn;
  localStorage.setItem("soundOn", JSON.stringify(soundOn));
  updateSoundIcon();
}

function updateSoundIcon(){
  const el = document.getElementById("soundIcon");
  if(el) el.textContent = soundOn ? "ğŸ”Š" : "ğŸ”‡";
}


/* ===== DATA ===== */
let data = JSON.parse(localStorage.getItem("flashData_v76")) || { topics:{} };
let stats = JSON.parse(localStorage.getItem("stats_v76")) || {
  sessions:0, history:[], perTopic:{}, hardWords:{}
};

let session=[], current=null;
let sessionDefaultDirection="A";
let cardFlipped=false;
let shuffleUsed=false;
let currentTopic=null;
let lastAddTopic="";

/* ===== UTIL ===== */
function save(){
  localStorage.setItem("flashData_v76",JSON.stringify(data));
  localStorage.setItem("stats_v76",JSON.stringify(stats));
}
function allWords(){
  let a=[];
  Object.keys(data.topics).forEach(t=>{
    if(t!=="All words") a.push(...data.topics[t]);
  });
  return a;
}

/* ===== NAV ===== */
function show(id){
  document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}
function showHome(){ loadTopics(); updateInstructions(); show("home"); }
function showBank(){ loadTopics(); show("bank"); }
function showStats(){ renderStats(); show("stats"); }
function showContact(){ show("contact"); }

function goHome(){
  if(stats.current){
    finishSessionIfActive();
  }

  importFile.value = "";

  showHome();
}



/* ===== HOME LOGIC ===== */
function updateInstructions(){
  document.getElementById("instructions")
    .classList.toggle("hidden", allWords().length>0);
}

/* ===== TOPICS ===== */

function loadTopics(){
  data.topics["All words"] = allWords();

  const hardLabel = "Hard Words";
  const topics = Object.keys(data.topics);

  /* ---------- HOME ---------- */
  topicSelect.innerHTML = '<option value="">Select topic</option>';
  topicSelect.innerHTML += `<option>${hardLabel}</option>`;
  topics.forEach(t=>{
    topicSelect.innerHTML += `<option>${t}</option>`;
  });

  /* ---------- BANK ---------- */
  bankTopicSelect.innerHTML = '<option value="">Select topic</option>';
  bankTopicSelect.innerHTML += `<option>${hardLabel}</option>`;
  topics.forEach(t=>{
    bankTopicSelect.innerHTML += `<option>${t}</option>`;
  });

  /* ---------- BANK LIST ---------- */
  bankListTopicSelect.innerHTML = "";
  topics.forEach(t=>{
    bankListTopicSelect.innerHTML += `<option>${t}</option>`;
  });

  if(currentTopic){
    bankListTopicSelect.value = currentTopic;
  }
}



/* ===== BANK ===== */

function switchBankListTopic(){
  const t = bankListTopicSelect.value;
  if(!t) return;
  currentTopic = t;
  deleteTopicBtn.classList.toggle("hidden", currentTopic === "All words");
  renderWordList();
}


function renameCurrentTopic(){
  if(!currentTopic || currentTopic === "All words") return;

  let newName = prompt("New topic name:", currentTopic);
  if(!newName || newName === currentTopic) return;

  if(data.topics[newName]){
    alert("Topic already exists");
    return;
  }

  data.topics[newName] = data.topics[currentTopic];
  delete data.topics[currentTopic];

  currentTopic = newName;
  lastAddTopic = newName;

  save();
  loadTopics();
  renderWordList();
}


function addWordToCurrentTopic(){
  if(!currentTopic) return;

  lastAddTopic = currentTopic;
  showAdd();
}

bankTopicSelect.onchange=()=>{
  if(!bankTopicSelect.value) return;
  currentTopic=bankTopicSelect.value;
  deleteTopicBtn.classList.toggle("hidden",currentTopic==="All words");
  renderWordList();
  show("bankList");
};

function renderWordList(){
  let q=searchInput.value.toLowerCase();
  let sort=sortSelect.value;
  wordList.innerHTML="";

  let arr=[...data.topics[currentTopic]];
  if(q) arr=arr.filter(w=>w.learn.toLowerCase().includes(q)||w.tr.toLowerCase().includes(q));
  if(sort==="learn") arr.sort((a,b)=>a.learn.localeCompare(b.learn));
  if(sort==="tr") arr.sort((a,b)=>a.tr.localeCompare(b.tr));

  arr.forEach((w,i)=>{
  wordList.innerHTML += `
    <div class="list-item">
      <div style="font-size:20px;font-weight:600;">
        ${i+1}. ${w.learn} â€“ ${w.tr}
      </div>

      <div class="actions">
        <button style="font-size:12px;padding:6px;" onclick="editWord(${w.id})">
          Edit
        </button>
        <button style="font-size:12px;padding:6px;" onclick="deleteWord(${w.id})">
          Delete
        </button>
      </div>
    </div>`;
});

}

function exportCurrentTopic(){
  let rows=["Learning language,Translation"];
  data.topics[currentTopic].forEach(w=>rows.push(`"${w.learn}","${w.tr}"`));
  let blob=new Blob([rows.join("\n")],{type:"text/csv"});
  let a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download=`${currentTopic}.csv`;
  a.click();
}

function deleteCurrentTopic(){
  if(confirm("Delete this topic and all its words?")){
    delete data.topics[currentTopic];
    save();
    showBank();
  }
}

function deleteWord(id){
  data.topics[currentTopic]=data.topics[currentTopic].filter(w=>w.id!==id);
  save();
  renderWordList();
}

function editWord(id){
  const w=data.topics[currentTopic].find(x=>x.id===id);
  deleteWord(id);
  showAdd();
  addTopicSelect.value=currentTopic;
  onAddTopicChange();
  learnInput.value=w.learn;
  translationInput.value=w.tr;
}
/* ===== ADD WORD ===== */

function showAdd(){
  learnInput.value = "";
  translationInput.value = "";
  newTopicInput.value = "";
  newTopicInput.disabled = true;
  newTopicInput.classList.add("hidden");

  loadAddTopics();
  show("add");
}

function loadAddTopics(){
  addTopicSelect.innerHTML = "";

  addTopicSelect.innerHTML += `<option value="">Select topic</option>`;
  addTopicSelect.innerHTML += `<option value="_new">+ New topic</option>`;

  Object.keys(data.topics).forEach(t=>{
    if(t !== "All words"){
      addTopicSelect.innerHTML += `<option value="${t}">${t}</option>`;
    }
  });

  if(lastAddTopic && data.topics[lastAddTopic]){
    addTopicSelect.value = lastAddTopic;
  } else {
    addTopicSelect.value = "";
  }

  onAddTopicChange();
}

function onAddTopicChange(){
  const isNew = addTopicSelect.value === "_new";

  newTopicInput.disabled = !isNew;
  newTopicInput.classList.toggle("hidden", !isNew);

  if(!isNew){
    newTopicInput.value = "";
  }
}

function saveWord(){
  const isNew = addTopicSelect.value === "_new";

  const topic = isNew
    ? newTopicInput.value.trim()
    : addTopicSelect.value;

  if(!topic || !learnInput.value || !translationInput.value) return;

  if(!data.topics[topic]){
    data.topics[topic] = [];
  }

  data.topics[topic].push({
    id: Date.now(),
    learn: learnInput.value,
    tr: translationInput.value
  });

  lastAddTopic = topic;
  currentTopic = topic;

  save();

  learnInput.value = "";
  translationInput.value = "";
  newTopicInput.value = "";
  newTopicInput.disabled = true;
  newTopicInput.classList.add("hidden");

  loadTopics();
  loadAddTopics();

  addTopicSelect.value = topic;
  onAddTopicChange();

  updateInstructions();
}





/* ===== IMPORT ===== */


function triggerImport(){
  importFile.click();
}

importFile.onchange = e => {
  const file = e.target.files[0];
  if(!file){
    importFile.value = "";
    return;
  }

  // ğŸ”¥ ×©× ×”× ×•×©× = ×©× ×”×§×•×‘×¥ ×‘×œ×™ ×¡×™×•××ª
  const topic = file.name.replace(/\.[^/.]+$/, "");

  // ×™×¦×™×¨×ª × ×•×©× ×—×“×© (××• × ×™×§×•×™ ×§×™×™×)
  data.topics[topic] = [];

  const reader = new FileReader();
  reader.onload = ev => {
    ev.target.result.split(/\r?\n/).forEach((line,i)=>{
      if(i === 0) return;

      const p = line.split(",");
      if(p.length >= 2){
        data.topics[topic].push({
          id: Date.now() + Math.random(),
          learn: p[0].replace(/"/g,""),
          tr: p.slice(1).join(",").replace(/"/g,"")
        });
      }
    });

    // ğŸ”¥ ×©××™×¨×” ×•×¢×“×›×•×Ÿ
    save();
    loadTopics();
    updateInstructions();

    // ğŸ”¥ ×‘×—×™×¨×ª ×”× ×•×©× ×•×¤×ª×™×—×ª ×¡×©×Ÿ ××•×˜×•××˜×™×ª
    currentTopic = topic;
    topicSelect.value = topic;

    importFile.value = "";

    startSession();   // ğŸ”¥ ×¤×•×ª×— ×¡×©×Ÿ ××™×™×“
  };

  reader.readAsText(file, "UTF-8");
};


/* ===== SESSION ===== */
function startSession(){
  currentTopic = topicSelect.value;
  if(!currentTopic) return;

  if(currentTopic === "Hard Words"){
    session = Object.entries(stats.hardWords)
      .filter(e => e[1] >= 2)
      .map(e => {
        let [learn, tr] = e[0].split("||");
        return { learn, tr };
      });
  } else {
    session = [...data.topics[currentTopic]];

    // ğŸ”¥ ×”×—×œ×ª ××™×•×Ÿ ×”×¨×©×™××” ×’× ×¢×œ ×”×¡×©×Ÿ
    const sort = sortSelect.value;
    if(sort === "learn"){
      session.sort((a,b)=>a.learn.localeCompare(b.learn));
    }
    if(sort === "tr"){
      session.sort((a,b)=>a.tr.localeCompare(b.tr));
    }
  }

  sessionDefaultDirection = "A";
  cardFlipped = false;
  shuffleUsed = false;
  shuffleBtn.classList.remove("hidden");


  stats.sessions++;
  stats.current = { topic: currentTopic, correct: 0, wrong: 0 };
  nextCard();
}

function nextCard(){
  if(session.length === 0){
    stats.history.push(stats.current);
    stats.history = stats.history.slice(-10);

    let t = stats.current.topic;
    if(!stats.perTopic[t]) stats.perTopic[t] = { correct: 0, wrong: 0 };
    stats.perTopic[t].correct += stats.current.correct;
    stats.perTopic[t].wrong += stats.current.wrong;

    save();
    showHome();
    return;
  }
  current = session[0];
  cardFlipped = false;
  renderCard();
  show("session");
}

function renderCard(){
  let side = cardFlipped
    ? (sessionDefaultDirection === "A" ? "B" : "A")
    : sessionDefaultDirection;

  const text = side === "A" ? current.learn : current.tr;
  card.textContent = text;

  if(shuffleUsed){
    shuffleBtn.classList.add("hidden");
  }

  requestAnimationFrame(() => {
    autoFitCardText();
  });

  document.getElementById("remainingCount").textContent = session.length;
}



function autoFitCardText(){
  const maxFont = 102;   // ×¤×™ 3
  const minFont = 18;

  let size = maxFont;
  card.style.fontSize = size + "px";

  while(size > minFont){
    card.style.fontSize = size + "px";

    // ×× ×™×© ×’×œ×™×©×” â€“ ××§×˜×™× ×™×
    if(
      card.scrollHeight > card.clientHeight ||
      card.scrollWidth  > card.clientWidth
    ){
      size -= 2;
    } else {
      break;
    }
  }
}


function flipCard(){
  cardFlipped = !cardFlipped;
  if(soundOn){
    flipSound.currentTime = 0;
    flipSound.play();
  }
  renderCard();
}



function flipDirection(){
  sessionDefaultDirection = sessionDefaultDirection === "A" ? "B" : "A";
  cardFlipped = false;
  renderCard();
}

function shuffleSession(){
  if(shuffleUsed) return;

  shuffleUsed = true;
  shuffleBtn.classList.add("hidden");

  session.sort(() => Math.random() - 0.5);

  current = session[0];
  cardFlipped = false;
  renderCard();
}


function markKnown(){
  if(soundOn){
    correctSound.currentTime = 0;
    correctSound.play();
  }
  stats.current.correct++;
  session.shift();
  nextCard();
}



function markUnknown(){
  stats.current.wrong++;
  let key = current.learn + "||" + current.tr;
  stats.hardWords[key] = (stats.hardWords[key] || 0) + 1;
  session.push(session.shift());
  nextCard();
}


function finishSessionIfActive(){
  if(!stats.current) return;

  stats.history.push(stats.current);
  stats.history = stats.history.slice(-10);

  const t = stats.current.topic;
  if(!stats.perTopic[t]){
    stats.perTopic[t] = { correct: 0, wrong: 0 };
  }

  stats.perTopic[t].correct += stats.current.correct;
  stats.perTopic[t].wrong += stats.current.wrong;

  stats.current = null;
  save();
}

function exitSession(){
  finishSessionIfActive();
  showHome();
}




/* ===== STATS ===== */
function renderStats(){
  let topics=Object.keys(data.topics).length-1;
  let words=allWords().length;

  let topicStats="";
  Object.keys(stats.perTopic).forEach(t=>{
    let c=stats.perTopic[t].correct;
    let w=stats.perTopic[t].wrong;
    let acc=c+w>0?Math.round(c/(c+w)*100):0;
    topicStats+=`
      <div class="stat-block">
        <strong>Topic: ${t}</strong><br>
        Correct: ${c}<br>
        Wrong: ${w}<br>
        Accuracy: ${acc}%
      </div>`;
  });

  let hardEntries = Object.entries(stats.hardWords)
    .filter(e => e[1] >= 2)
    .sort((a,b)=>b[1]-a[1]);

  let hardTable = hardEntries.length ? `
    <button onclick="goHome()" class="back">Back</button>

    <table class="hard-table">
      <thead>
        <tr>
          <th>Hard Words</th>
          <th>Times Wrong</th>
        </tr>
      </thead>
      <tbody>
        ${hardEntries.map(e=>{
          let [learn,tr] = e[0].split("||");
          return `
            <tr>
              <td class="hard-word">${learn} â€“ ${tr}</td>
              <td class="hard-count">${e[1]}</td>
            </tr>`;
        }).join("")}
      </tbody>
    </table>
  ` : "<p>No hard words yet</p>";

  statsContent.innerHTML=`
    <p>Topics: ${topics}</p>
    <p>Words: ${words}</p>
    <p>Sessions started: ${stats.sessions}</p>
    <hr>
    <h3>By topic</h3>
    ${topicStats||"<p>No data</p>"}
    <hr>
    <h3>Hard Words</h3>
    ${hardTable}
  `;
}

function resetStats(){
  if(!confirm("Reset ALL statistics?")) return;

  stats = {
    sessions: 0,
    history: [],
    perTopic: {},
    hardWords: {}
  };

  localStorage.setItem("stats_v76", JSON.stringify(stats));
  renderStats();
}


/* ===== MISC ===== */
function openLink(u){ window.open(u,"_blank"); }
function exitApp(){ window.close(); }

/* INIT */
loadTopics();
updateInstructions();
</script>

<script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("sw.js").then(reg => {
    reg.update(); // ×‘×“×™×§×ª ×¢×“×›×•×Ÿ ×‘×›×œ ×¤×ª×™×—×”
  });

  navigator.serviceWorker.addEventListener("controllerchange", () => {
    window.location.reload(); // ×˜×¢×™× ×ª ×’×¨×¡×” ×—×“×©×” ××•×˜×•××˜×™×ª
  });
}
</script>


</body>
</html>
